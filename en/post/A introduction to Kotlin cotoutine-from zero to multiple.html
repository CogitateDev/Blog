<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>A introduction to Kotlin cotoutine-from zero to multiple &#183; Deep thinking</title>
<meta name=title content="A introduction to Kotlin cotoutine-from zero to multiple &#183; Deep thinking"><script type=text/javascript src=/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.b0785c8131a75f72b211435af86269eb2d4b81dda03a8f2cf5ccb1c967747167.css integrity="sha256-sHhcgTGnX3KyEUNa+GJp6y1Lgd2gOo8s9cyxyWd0cWc="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.af5d9722112bedac95702865c340bcd6286c4e9b2c15ce26b531ea1fba974cb8.js integrity="sha256-r12XIhEr7ayVcChlw0C81ihsTpssFc4mtTHqH7qXTLg=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      A introduction to Kotlin cotoutine-from zero to multiple
    "><link rel=canonical href=https://bravebuffalo.cc/en/post/A%20introduction%20to%20Kotlin%20cotoutine-from%20zero%20to%20multiple.html><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://bravebuffalo.cc/en/post/A%20introduction%20to%20Kotlin%20cotoutine-from%20zero%20to%20multiple.html"><meta property="og:site_name" content="Deep thinking"><meta property="og:title" content="A introduction to Kotlin cotoutine-from zero to multiple"><meta property="og:description" content="A introduction to Kotlin cotoutine-from zero to multiple"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-30T19:10:30+08:00"><meta property="article:modified_time" content="2021-03-30T19:10:30+08:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="Kotlin"><meta property="article:tag" content="Coroutine"><meta name=twitter:card content="summary"><meta name=twitter:title content="A introduction to Kotlin cotoutine-from zero to multiple"><meta name=twitter:description content="A introduction to Kotlin cotoutine-from zero to multiple"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"A introduction to Kotlin cotoutine-from zero to multiple","headline":"A introduction to Kotlin cotoutine-from zero to multiple","description":"A introduction to Kotlin cotoutine-from zero to multiple","abstract":"\u003cblockquote\u003e\n\u003cp\u003eIn the last post, I introduced the creation, use, and collaboration of Kotlin coroutines. This post will introduce more usage scenarios and continue to take you into the world of coroutines.\u003c\/p\u003e\n\u003c\/blockquote\u003e\n\u003ch3 id=\u0022使用协程处理异步数据流\u0022 class=\u0022relative group\u0022\u003e使用协程处理异步数据流 \u003cspan class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100\u0022\u003e\u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022 style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#%e4%bd%bf%e7%94%a8%e5%8d%8f%e7%a8%8b%e5%a4%84%e7%90%86%e5%bc%82%e6%ad%a5%e6%95%b0%e6%8d%ae%e6%b5%81\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\u003c\/span\u003e\u003c\/h3\u003e\u003cp\u003eCommon programming languages have built-in representations of datasets of different objects of the same type, often called container classes. Different container classes are suitable for different usage scenarios, and Kotlin\u0026rsquo;s \u003ccode\u003eFlow\u003c\/code\u003e was introduced to represent asynchronous data flow in the context of asynchronous computing.\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/bravebuffalo.cc\/en\/post\/A%20introduction%20to%20Kotlin%20cotoutine-from%20zero%20to%20multiple.html","author":{"@type":"Person","name":"Deep thinking"},"copyrightYear":"2021","dateCreated":"2021-03-30T19:10:30\u002b08:00","datePublished":"2021-03-30T19:10:30\u002b08:00","dateModified":"2021-03-30T19:10:30\u002b08:00","keywords":["Android","Kotlin","Coroutine"],"mainEntityOfPage":"true","wordCount":"1236"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://bravebuffalo.cc/en/","name":"Deep Thinking","position":1},{"@type":"ListItem","item":"https://bravebuffalo.cc/en/posts/","name":"Posts","position":2},{"@type":"ListItem","item":"https://bravebuffalo.cc/en/categories/coroutine/","name":"Coroutine","position":3},{"@type":"ListItem","name":"A Introduction to Kotlin Cotoutine From Zero to Multiple","position":4}]}</script><meta name=author content="Deep thinking"><link href=mailto:honguilee@163.com rel=me><link href=https://github.com/hongui rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a href=/en/ class=mr-2><img src=/images/logo.png width=500 height=500 class="max-h-[10rem] max-w-[10rem] object-scale-down object-left" alt="Deep thinking">
</a><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/en/>Deep thinking</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/en/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/en/categories/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Categories</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/en/tags/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/en/about.html title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=search-button-1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><div class="group relative"><button class="group-dark:hover:text-primary-400 flex w-full items-center justify-end transition-colors group-hover:text-primary-600">
<span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 16 16"><path fill="currentcolor" d="M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286H4.545zm1.634-.736L5.5 3.956h-.049l-.679 2.022H6.18z"/><path fill="currentcolor" d="M0 2a2 2 0 012-2h7a2 2 0 012 2v3h3a2 2 0 012 2v7a2 2 0 01-2 2H7a2 2 0 01-2-2v-3H2A2 2 0 010 9V2zm2-1A1 1 0 001 2v7a1 1 0 001 1h7a1 1 0 001-1V2A1 1 0 009 1H2zm7.138 9.995c.193.301.402.583.63.846-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.047h.765c-.318.844-.74 1.546-1.272 2.13a6.066 6.066.0 01-.415-.492 1.988 1.988.0 01-.94.31z"/></svg>
</span><span class=text-sm>EN</span><span class=text-[0.6rem]><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3.0l192-192c12.5-12.5 12.5-32.8.0-45.3s-32.8-12.5-45.3.0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3.0s-12.5 32.8.0 45.3l192 192z"/></svg></span></span></button><div class="invisible w-full bg-transparent group-hover:visible"></div><div class="invisible absolute z-50 flex flex-col whitespace-nowrap rounded border border-neutral-300 bg-neutral text-start text-base shadow group-hover:visible ltr:right-0 rtl:left-0 dark:border-neutral-600 dark:bg-neutral-800"><div class="flex flex-grow"><a href=/en/post/A%20introduction%20to%20Kotlin%20cotoutine-from%20zero%20to%20multiple.html class="flex w-full items-center justify-between bg-primary-100 px-2 py-1 dark:bg-primary-900">English<span class="ms-2 w-6 text-primary-600 dark:text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M438.6 105.4c12.5 12.5 12.5 32.7.0 45.2l-256 256c-12.5 12.5-32.7 12.5-45.2.0L9.372 278.6c-12.496-12.5-12.496-32.7.0-45.2 12.498-12.5 32.758-12.5 45.258.0L159.1 338.7 393.4 105.4c12.5-12.52 32.7-12.52 45.2.0h0z"/></svg></span></span></a></div><div class="flex flex-grow"><a href=/post/Kotlin%E5%8D%8F%E7%A8%8B-%E4%BB%8E%E4%B8%80%E5%88%B0%E5%A4%9A.html class="w-full py-1 pe-10 ps-2 decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2">简体中文</a></div></div></div></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">A introduction to Kotlin cotoutine-from zero to multiple</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-03-30 19:10:30 +0800 +0800">30 March 2021</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">6 mins</span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="min-h-0 min-w-0 max-w-prose grow"><blockquote><p>In the last post, I introduced the creation, use, and collaboration of Kotlin coroutines. This post will introduce more usage scenarios and continue to take you into the world of coroutines.</p></blockquote><h3 id=使用协程处理异步数据流 class="relative group">使用协程处理异步数据流 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%bd%bf%e7%94%a8%e5%8d%8f%e7%a8%8b%e5%a4%84%e7%90%86%e5%bc%82%e6%ad%a5%e6%95%b0%e6%8d%ae%e6%b5%81 aria-label=Anchor>#</a></span></h3><p>Common programming languages have built-in representations of datasets of different objects of the same type, often called container classes. Different container classes are suitable for different usage scenarios, and Kotlin&rsquo;s <code>Flow</code> was introduced to represent asynchronous data flow in the context of asynchronous computing.</p><h4 id=flow class="relative group">Flow <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#flow aria-label=Anchor>#</a></span></h4><p>Asynchronous data flow is basically about getting asynchronous data in some way, and Kotlin provides many ways to do this, the more common ones being the <code>asFlow</code> extension of the Kotlin coroutine package and the <code>flow</code> constructor. The former is a <code>Flow</code>-ized encapsulation of a common dataset, nothing more, so let&rsquo;s focus on the latter.</p><p>The main goal of the <code>flow</code> constructor is to generate an asynchronous data flow, which is a generic function that takes a pending function as its argument and a <code>FlowCollector</code> as an extension function. This interface has only one <code>emit</code> method, which is to provide asynchronously computed data to the created <code>Flow</code>, and because it&rsquo;s a pending function, we can use other pending functions inside it to compute asynchronous values, and then send the values out via the <code>emit</code> method, and so on to provide a constant stream of data for downstream operations.</p><p>That&rsquo;s not all. The above steps only specify how the data is created, they don&rsquo;t actually execute it, i.e., the road is built, but there&rsquo;s no car on the road yet. So how do we get the car on the road, looking at the <code>Flow</code> interface you will see that it provides the <code>collect</code> method to process the data. <code>collect</code> receives a pending function as processing logic, but at the same time, the <code>collect</code> method itself is also a pending function, so the method can only be run in a pending function. With this knowledge, we can write the simplest asynchronous data flow.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl> <span class=m>1u</span><span class=n>spend</span> <span class=k>fun</span> <span class=nf>compute</span><span class=p>():</span><span class=n>Int</span><span class=p>{</span>
</span></span><span class=line><span class=cl>             <span class=n>delay</span><span class=p>(</span><span class=m>123</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=k>return</span> <span class=m>1024</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> <span class=n>viewModelScope</span><span class=p>.</span><span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=k>val</span> <span class=py>flow</span><span class=p>=</span><span class=n>flow</span><span class=p>&lt;</span><span class=n>Int</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=n>emit</span><span class=p>(</span><span class=m>9527</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=n>emit</span><span class=p>(</span><span class=n>compute</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>delay</span><span class=p>(</span><span class=m>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>emit</span><span class=p>(</span><span class=m>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>flow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=k>it</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Feel free to do all sorts of operations inside the <code>flow</code> constructor, just pass the result when necessary, but note that the <code>emit</code> method can only run in the same coroutine. At first glance, there&rsquo;s no fundamental difference between writing them separately and writing them together, but <code>Flow</code> can do a lot more.</p><h3 id=its-time-to-change-flows-working-environment class="relative group">It&rsquo;s time to change Flow&rsquo;s working environment <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#its-time-to-change-flows-working-environment aria-label=Anchor>#</a></span></h3><p>In the previous section, our simple example, if we replaced the data fetch method in the constructor with a network request, the application would be dead in the water. This is because they are running in the main thread. At this point, those of you who have read the previous article will immediately react by using the <code>withContext</code> method to switch threads inside the constructor. The idea is correct, because the default configuration of <code>Flow</code> is that the constructor and the <code>collect</code> method work in the same thread, and since the main thread is not allowed to run now, then we can just switch the thread of the constructor. But that&rsquo;s not the case. The code you write this way won&rsquo;t run at all. This is because there is a unique <code>flowOn</code> method to switch the thread of execution of the constructor. It&rsquo;s as simple as configuring the <code>flowOn</code> method once on the created <code>Flow</code> object.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>flow</span><span class=p>=[</span><span class=s2>&#34;1.jpg&#34;</span><span class=p>,</span><span class=s2>&#34;2.jpg&#34;</span><span class=p>].</span><span class=n>asFlow</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>flow</span><span class=p>.</span><span class=n>map</span> <span class=p>{</span> <span class=n>decode</span><span class=p>(</span><span class=k>it</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>flowOn</span><span class=p>(</span><span class=nc>Dispatchers</span><span class=p>.</span><span class=n>IO</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>viewModelScope</span><span class=p>.</span><span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>flow</span><span class=p>.</span><span class=n>collect</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>adapter</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=k>it</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h3 id=some-intermediate-processing-logic class="relative group">Some intermediate processing logic <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#some-intermediate-processing-logic aria-label=Anchor>#</a></span></h3><p>Those of you who are familiar with RxJava may be wondering, these operations can be done by RxJava, and there are even more operators to support intermediate state processing, so can asynchronous data streaming do all this. Undoubtedly, it can. Ordinary datasets have <code>map</code>,<code>filter</code> and other methods that work just as well for asynchronous data streams. And all of these methods take pending functions as arguments, which can perform asynchronous operations. And it also has a more flexible <code>transform</code> method, this method can be customized with its own operators to achieve more flexible data manipulation.</p><p>Of course, all of the above operators can only be implemented for a single asynchronous stream, and it is equally well suited to support multiple streams. <code>zip</code> can combine two data sources, and the length of the combined stream is the length of the shortest of the two streams. Unlike <code>zip</code>, <code>combine</code> takes as input the most recent send of the two streams, i.e., if you have a piece of one slow stream, the elements of the slow stream may be fetched more than once, so that the final stream is longer than the shortest one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>flow</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=m>2</span><span class=p>).</span><span class=n>delayEach</span><span class=p>(</span><span class=m>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>val</span> <span class=py>flow2</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>,</span> <span class=s2>&#34;c&#34;</span><span class=p>).</span><span class=n>delayEach</span><span class=p>(</span><span class=m>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flow</span><span class=p>.</span><span class=n>combine</span><span class=p>(</span><span class=n>flow2</span><span class=p>)</span> <span class=p>{</span> <span class=n>i</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>i</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span> <span class=p>+</span> <span class=n>s</span> <span class=p>}.</span><span class=n>collect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=n>println</span><span class=p>(</span><span class=k>it</span><span class=p>)</span> <span class=c1>// Will print &#34;1a 2a 2b 2c&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=end-state-tracking class="relative group">End State Tracking <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#end-state-tracking aria-label=Anchor>#</a></span></h3><p>As mentioned in the previous section, since the data source and the processing logic are not in the same place, it is difficult to determine the size of the final data stream, and thus not know when the data stream is finished processing. Also, intermediate operations may change the size of the data stream, which makes it even more difficult to determine when the data processing is finished. But there are times when we need to do something after the data has been processed, so what should we do? This is where the <code>onCompletion</code> method comes in. This method takes a null <code>Throwable</code> parameter, which obviously indicates both results, success or failure, and passes in the exception if it fails.</p><h3 id=multiple-coroutines-working-together class="relative group">Multiple Coroutines Working Together <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#multiple-coroutines-working-together aria-label=Anchor>#</a></span></h3><p>In many cases, it&rsquo;s impossible to avoid having multiple coroutines working together. For coroutines that return a single value, as we mentioned in the previous article, you can pass <code>Deferred</code>, the return object of the <code>async</code> constructor, but the limitation is that you can only pass one value to this object. Kotlin provides a <code>Channel</code> solution to the multi-value passing case. A <code>Channel</code> is similar to a blocking queue, where data is sent out via the <code>send</code> method and received in another place using the <code>receive</code> method. With this approach, we can provide great efficiency in working with coroutines. It is easy to implement the producer and consumer model using it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl> <span class=k>val</span> <span class=py>chanel</span><span class=p>=</span><span class=n>Channel</span><span class=p>&lt;</span><span class=n>Int</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=cl> <span class=n>viewModelScope</span><span class=p>.</span><span class=n>launch</span><span class=p>(</span><span class=nc>Dispatchers</span><span class=p>.</span><span class=n>IO</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=k>in</span> <span class=m>1.</span><span class=p>.</span><span class=m>5</span><span class=p>){</span>
</span></span><span class=line><span class=cl>         <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=n>chanel</span><span class=p>.</span><span class=n>send</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=n>viewModelScope</span><span class=p>.</span><span class=n>launch</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>     <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=k>in</span> <span class=n>chanel</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Handle </span><span class=si>${i}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Of course, this is just the simplest usage, and more producers can be added, or eliminated when the data is no longer needed, and there is even a specialized <code>product</code> constructor to directly get coroutines that return multiple values.</p><h3 id=summary class="relative group">Summary <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#summary aria-label=Anchor>#</a></span></h3><p>Kotlin coroutines have a lot of useful APIs which cover most of the asynchronous usage scenarios. So when using coroutines, we first need to clarify the use of scenarios, and then according to the use of scenarios to determine the use of which set of APIs, which can make us avoid falling into API phobia. To this end, I have organized a scenario table based on the content of these two articles, you can refer to the use of the actual development.
Kotlin coroutine constructor</p><table><thead><tr><th>API</th><th>Usage</th></tr></thead><tbody><tr><td>launch</td><td>Performs time-consuming operations with no return value</td></tr><tr><td>async</td><td>Need to get a single return value for time-consuming operations</td></tr><tr><td>produce</td><td>Need to get multiple return values for time-consuming operations</td></tr></tbody></table><p>Kotlin Coroutine Collaboration Tool</p><table><thead><tr><th>API</th><th>Usage</th></tr></thead><tbody><tr><td>Flow</td><td>Manipulating Asynchronous Data Streams</td></tr><tr><td>Channel</td><td>Coroutines communicate with each other</td></tr></tbody></table></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=1000 height=1000 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt="Deep thinking" loading=lazy decoding=async src=/images/logo_hu1444715804356428735.png srcset="/images/logo_hu10122803172005691567.png 330w,/images/logo_hu1444715804356428735.png 660w
,/images/logo.png 1000w
,/images/logo.png 1000w" sizes=100vw></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Deep thinking</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=mailto:honguilee@163.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/hongui target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/en/post/A%20introduction%20to%20Kotlin%20coroutine-from%20theory%20to%20practice.html><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">A introduction to Kotlin coroutine-from theory to practice</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-03-27 19:02:30 +0800 +0800">27 March 2021</time>
</span></span></a></span><span><a class="group flex text-right" href=/en/post/Personal%20understanding%20and%20useage%20of%20CMake.html><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Personal understanding and useage of CMake</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-08-09 19:21:49 +0800 +0800">9 August 2021</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div></footer></article></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2024
Deep thinking</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://bravebuffalo.cc/en/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>