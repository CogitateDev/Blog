<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>Introduction to Android NDK-basic concepts &#183; Deep thinking</title>
<meta name=title content="Introduction to Android NDK-basic concepts &#183; Deep thinking"><script type=text/javascript src=/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.b0785c8131a75f72b211435af86269eb2d4b81dda03a8f2cf5ccb1c967747167.css integrity="sha256-sHhcgTGnX3KyEUNa+GJp6y1Lgd2gOo8s9cyxyWd0cWc="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.af5d9722112bedac95702865c340bcd6286c4e9b2c15ce26b531ea1fba974cb8.js integrity="sha256-r12XIhEr7ayVcChlw0C81ihsTpssFc4mtTHqH7qXTLg=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      Introduction to Android NDK-basic concepts
    "><link rel=canonical href=https://bravebuffalo.cc/en/post/Introduction%20to%20Android%20NDK-basic%20concepts.html><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://bravebuffalo.cc/en/post/Introduction%20to%20Android%20NDK-basic%20concepts.html"><meta property="og:site_name" content="Deep thinking"><meta property="og:title" content="Introduction to Android NDK-basic concepts"><meta property="og:description" content="Introduction to Android NDK-basic concepts"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-06T11:30:40+08:00"><meta property="article:modified_time" content="2022-03-06T11:30:40+08:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="JNI"><meta property="article:tag" content="C/C++"><meta property="article:tag" content="NDK"><meta name=twitter:card content="summary"><meta name=twitter:title content="Introduction to Android NDK-basic concepts"><meta name=twitter:description content="Introduction to Android NDK-basic concepts"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Introduction to Android NDK-basic concepts","headline":"Introduction to Android NDK-basic concepts","description":"Introduction to Android NDK-basic concepts","abstract":"\u003cp\u003eSometimes it is necessary to use libraries written in C\/C\u002b\u002b for security, performance, and code sharing considerations during the development. Although with the support of modern tool chains, the difficulty of this work has been greatly reduced, after all, everything is difficult at the beginning, and beginners often still encounter many unpredictable problems. This article is a simple guide written based on this background. I hope it will be helpful to readers who have just started writing C\/C\u002b\u002b libraries. At the same time, in order to reduce cognitive gaps as much as possible, this article will try to start with the simplest function and gradually add tool chains until the final function is achieved, truly knowing what is happening and why.\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/bravebuffalo.cc\/en\/post\/Introduction%20to%20Android%20NDK-basic%20concepts.html","author":{"@type":"Person","name":"Deep thinking"},"copyrightYear":"2022","dateCreated":"2022-03-06T11:30:40\u002b08:00","datePublished":"2022-03-06T11:30:40\u002b08:00","dateModified":"2022-03-06T11:30:40\u002b08:00","keywords":["Android","JNI","C/C++","NDK"],"mainEntityOfPage":"true","wordCount":"5633"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://bravebuffalo.cc/en/","name":"Deep Thinking","position":1},{"@type":"ListItem","item":"https://bravebuffalo.cc/en/posts/","name":"Posts","position":2},{"@type":"ListItem","item":"https://bravebuffalo.cc/en/categories/ndk/","name":"NDK","position":3},{"@type":"ListItem","name":"Introduction to Android Ndk Basic Concepts","position":4}]}</script><meta name=author content="Deep thinking"><link href=mailto:honguilee@163.com rel=me><link href=https://github.com/hongui rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a href=/en/ class=mr-2><img src=/images/logo.png width=500 height=500 class="max-h-[10rem] max-w-[10rem] object-scale-down object-left" alt="Deep thinking">
</a><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/en/>Deep thinking</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/en/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/en/categories/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Categories</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/en/tags/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/en/about.html title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><button id=search-button-1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><div class="group relative"><button class="group-dark:hover:text-primary-400 flex w-full items-center justify-end transition-colors group-hover:text-primary-600">
<span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 16 16"><path fill="currentcolor" d="M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286H4.545zm1.634-.736L5.5 3.956h-.049l-.679 2.022H6.18z"/><path fill="currentcolor" d="M0 2a2 2 0 012-2h7a2 2 0 012 2v3h3a2 2 0 012 2v7a2 2 0 01-2 2H7a2 2 0 01-2-2v-3H2A2 2 0 010 9V2zm2-1A1 1 0 001 2v7a1 1 0 001 1h7a1 1 0 001-1V2A1 1 0 009 1H2zm7.138 9.995c.193.301.402.583.63.846-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.047h.765c-.318.844-.74 1.546-1.272 2.13a6.066 6.066.0 01-.415-.492 1.988 1.988.0 01-.94.31z"/></svg>
</span><span class=text-sm>EN</span><span class=text-[0.6rem]><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3.0l192-192c12.5-12.5 12.5-32.8.0-45.3s-32.8-12.5-45.3.0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3.0s-12.5 32.8.0 45.3l192 192z"/></svg></span></span></button><div class="invisible w-full bg-transparent group-hover:visible"></div><div class="invisible absolute z-50 flex flex-col whitespace-nowrap rounded border border-neutral-300 bg-neutral text-start text-base shadow group-hover:visible ltr:right-0 rtl:left-0 dark:border-neutral-600 dark:bg-neutral-800"><div class="flex flex-grow"><a href=/post/Android-NDk%E5%BC%80%E5%8F%91%E2%80%94%E2%80%94%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.html class="w-full py-1 pe-10 ps-2 decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2">简体中文</a></div><div class="flex flex-grow"><a href=/en/post/Introduction%20to%20Android%20NDK-basic%20concepts.html class="flex w-full items-center justify-between bg-primary-100 px-2 py-1 dark:bg-primary-900">English<span class="ms-2 w-6 text-primary-600 dark:text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M438.6 105.4c12.5 12.5 12.5 32.7.0 45.2l-256 256c-12.5 12.5-32.7 12.5-45.2.0L9.372 278.6c-12.496-12.5-12.496-32.7.0-45.2 12.498-12.5 32.758-12.5 45.258.0L159.1 338.7 393.4 105.4c12.5-12.52 32.7-12.52 45.2.0h0z"/></svg></span></span></a></div></div></div></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Introduction to Android NDK-basic concepts</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-03-06 11:30:40 +0800 +0800">6 March 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">27 mins</span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="min-h-0 min-w-0 max-w-prose grow"><p>Sometimes it is necessary to use libraries written in C/C++ for security, performance, and code sharing considerations during the development. Although with the support of modern tool chains, the difficulty of this work has been greatly reduced, after all, everything is difficult at the beginning, and beginners often still encounter many unpredictable problems. This article is a simple guide written based on this background. I hope it will be helpful to readers who have just started writing C/C++ libraries. At the same time, in order to reduce cognitive gaps as much as possible, this article will try to start with the simplest function and gradually add tool chains until the final function is achieved, truly knowing what is happening and why.</p><h1 id=target class="relative group">Target <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#target aria-label=Anchor>#</a></span></h1><p>The goal of this article is very simple, which is to call C/C++ functions in Android applications - receiving two integer values ​​and returning the value after adding the two. This function is tentatively named <code>plus</code>.</p><h1 id=begin-with-the-c-source-file class="relative group">Begin with the C++ source file <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#begin-with-the-c-source-file aria-label=Anchor>#</a></span></h1><p>In order to start from where we are most familiar, we&rsquo;ll start with the original C++ source files without the use of sophisticated tools.</p><p>Open any text editor you like, VS Code, Notpad++, Notepad, create a new text file and save it as <code>math.cpp</code>. Next, you can write code in this file.</p><p>Our goal, as stated earlier, is to implement a <code>plus</code> function that takes two integer values and returns the sum of the two, so it might look like below</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>int</span> <span class=nf>plus</span><span class=p>(</span><span class=kt>int</span> <span class=n>left</span><span class=p>,</span><span class=kt>int</span> <span class=n>right</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>left</span> <span class=o>+</span> <span class=n>right</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Out work is done, isn&rsquo;t it simple.</p><p>But just having the source file is not enough, because this is just for humans, machines can&rsquo;t read it. So we need the first tool - a compiler. A compiler helps us to convert what is human-readable into something that is machine-readable.</p><h1 id=the-compiler class="relative group">The compiler <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-compiler aria-label=Anchor>#</a></span></h1><p>The compiler is a complex project, but the two main functions are as follows</p><ol><li>to understand the content of the source file (human-readable) - to check for syntax errors in the source file</li><li>to understand the content of the binary (machine-readable) - to generate binary machine code.</li></ol><p>Around these two main functions, the compiler needs to complete a lot of work, especially function 2. Based on this difficulty, compilers are divided into a variety of common compilers, such as VS for Windows platform, G++ for Linux platform, Apple&rsquo;s Clang, and for Android, the situation is slightly different, the previous compilers are running on a specific system, compiled programs usually can only run on the corresponding system. The compiled program usually only runs on the corresponding system. Taking my current machine as an example, I&rsquo;m writing C++ code on Deepin right now, but the goal is to have the code run on an Android phone, two different platforms. More pessimistically, so far, there is no compiler that will run on a phone. Does that mean we can&rsquo;t run C++ code on a phone? Of course not, because there is cross-compilation.</p><p>Cross-compilation is the technique of generating code on one platform into executable objects on another. The biggest difference between cross-compilation and normal compilation is in linking. Because the general link directly to the system library to find the appropriate library files, while cross-compilation can not, because the current platform is not the final platform to run the code. So cross-compile also need to have the common libraries of the target platform. Of course, Google has prepared all these for us, called NDK.</p><h1 id=ndk class="relative group">NDK <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ndk aria-label=Anchor>#</a></span></h1><p>NDK full name is Native Development Kit, there are many tools, compilers, linkers, standard libraries, shared libraries. These are all essential parts of cross-compilation. In order to understand the convenience, we first take a look at its file structure. Take the version on my machine as an example - <code>/home/Andy/Android/Sdk/ndk/21.4.7075529</code> (the default location on Windows is <code>c:\Users\xxx\AppData\Local\Android\\). Sdk\</code>). The NDK is stored in the Sdk directory, named <code>ndk</code>, and the version number is used as the root directory for that version, as in the example, the version of NDK I installed is <code>21.4.7075529</code>. The example is also the value of the <code>ANDROID_NDK</code> environment variable. In other words, before determining the environment variable, we need to determine the version of the NDK to use, and the path value is taken to the version number directory.</p><p>Knowing where it is stored, we next need to recognize two important directories</p><ul><li><code>build/cmake/</code>, a folder that we&rsquo;ll expand on later.</li><li><code>toolchains/llvm/prebuild/linux-x86_64</code>, the last <code>linux-x86_64</code> has a different name depending on the platform, e.g. it starts with Windows on Windows platforms, but you can&rsquo;t go wrong with it because it&rsquo;s just one folder under the path and it&rsquo;s preceded by the same one. There are compilers, linkers, libraries, headers and so on. For example, the compilers are in the <code>bin</code> directory in this path, and they all end in <code>clang</code> and <code>clang++</code>, like <code>aarch64-linux-android21-clang++</code>.</li></ul><ol><li><p><code>aarch64</code> means that this compiler can generate binaries for use on <code>arm64</code> architecture machines, the other equivalents are <code>armv7a</code>, <code>x86_64</code>, etc. Different platforms use matching compilers. It is the target platform that is referred to in cross-compilation.</p></li><li><p><code>linux</code> means that we perform the compilation operation on a <code>linux</code> machine, which is the host platform in cross-compilation.</p></li><li><p><code>android21</code> is obviously the target system version.</p></li><li><p><code>clang++</code> means that it is a C++ compiler, and the corresponding C compiler is <code>clang</code>.</p></li></ol><p>As you can see, for Android, different hosts, different instruction sets, different Android versions, all correspond to a compiler.
After learning so much, it&rsquo;s finally time to get excited about the human nature. Next, let&rsquo;s compile the C++ file in front of us.</p><h1 id=compile class="relative group">Compile <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#compile aria-label=Anchor>#</a></span></h1><p>Looking at the parameters via <code>aarch64-linux-android21-clang++ --help</code>, you&rsquo;ll see that it has a lot of parameters and options, and now we just want to verify that our C++ source file doesn&rsquo;t have any syntax errors, so we&rsquo;ll just ignore all that complexity, and just a <code>aarch64-linux-android21- clang++ -c math.cpp</code>.</p><p>After the command is executed, if all goes well, a <code>math.o</code> object file will be generated in the same directory as <code>math.cpp</code>, which means that our source code has no syntax errors and we can proceed to the next step of linking.</p><p>But before that, a quick interruption. Often our projects contain many source files, referencing some third-party libraries, and each time we compile them manually, linking is obviously inefficient and error-prone. Nowadays, when tools are mature, we should try to use mature tools and focus on our business logic, <code>CMake</code> is one such tool.</p><h1 id=cmake class="relative group">CMake <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cmake aria-label=Anchor>#</a></span></h1><p>CMake is a cross-platform project builder. How to understand it? When writing C++ code, sometimes you need to refer to file headers in other directories, but in the compilation stage, the compiler doesn&rsquo;t know where to look for the headers, so you need a configuration to tell the compiler where to look for the headers. Furthermore, source code distributed in different directories needs to be packaged into different libraries according to certain needs. Or, if the project references third-party libraries, you need to tell the linker where to look for the libraries during the linking phase, and all of these are things that need to be configured.</p><p>Different systems and different IDEs have different support for these configurations, such as Visual Studio on Windows, which needs to be configured in the project&rsquo;s properties. When developers use the same tools, the problem is not so big. But once involved in the case of multi-platform, multi-IDE, collaborative development will spend a lot of time in the configuration of the CMake is to solve these problems came into being.</p><p>CMake configuration information is written in a file called <code>CMakeLists.txt</code>. As I mentioned earlier, header file references, source code dependencies, library dependencies, etc., only need to be written once in <code>CmakeLists.txt</code>, and can be used seamlessly on all major IDEs on Windows, MacOS, and Linux platforms. For example, I created a CMake project on Visual Studio for Windows, configured the dependencies, and passed it to a coworker. When my colleague develops on MacOS, he can immediately finish compiling, packaging, testing, etc. without any modification. This is the power of CMake cross-platform - simple, efficient, flexible.</p><h1 id=manage-project-with-cmake class="relative group">Manage project with CMake <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#manage-project-with-cmake aria-label=Anchor>#</a></span></h1><h2 id=create-a-cmake-project class="relative group">Create a CMake project <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#create-a-cmake-project aria-label=Anchor>#</a></span></h2><p>We already have <code>math.cpp</code> and CMake above, so let&rsquo;s combine them now.</p><p>How do we create a CMake project? There are three steps:</p><ol><li>Create a folder</li></ol><p>In the example, let&rsquo;s create a folder <code>math</code>.</p><ol start=2><li><p>Create a new <code>CMakeLists.txt</code> text file in the new folder. Note that the name of the file cannot be changed.</p></li><li><p>Configure the project information in the new <code>CMakeLists.txt</code> file.
The simplest CMake project needs to include at least three infomation</p></li></ol><ol><li>Minimum CMake version supported</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=nb>cmake_minimum_required</span><span class=p>(</span><span class=s>VERSION</span> <span class=s>3.18.1</span><span class=p>)</span><span class=err>
</span></span></span></code></pre></div><ol start=2><li>Project name</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=nb>project</span><span class=p>(</span><span class=s>math</span><span class=p>)</span><span class=err>
</span></span></span></code></pre></div><ol start=3><li>Product - The product could be executables or libraries. Since we are need a libraries on Android, so the product is a library.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=nb>add_library</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>SHARED</span> <span class=s>math.cpp</span><span class=p>)</span><span class=err>
</span></span></span></code></pre></div><p>After these three steps, the CMake project is built. Let&rsquo;s try compiling the project with CMake in the next step.</p><h2 id=compile-the-cmake-project class="relative group">Compile the CMake project <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#compile-the-cmake-project aria-label=Anchor>#</a></span></h2><p>Before executing the real compilation, CMake has a preparation phase, in which CMake collects the necessary information and then generates a project that meets the conditions before it can execute the compilation.</p><p>What is the necessary information? CMake will collect some information by guessing in order to minimize the complexity.</p><p>For example, if we perform the generation operation on Windows, CMake will default to Windows as the target platform and generate the VS project by default, so compiling Windows libraries on Windows is almost zero configuration.</p><ol><li><p>Create a new <code>build</code> directory in the <code>math</code> directory and switch the working directory to the <code>build</code> directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> build
</span></span><span class=line><span class=cl>cmake ..
</span></span></code></pre></div></li></ol><p>After the command is executed, you will find the VS project in the <code>build</code> directory, and you can open it directly with VS and compile it without errors. Of course, the faster way is to compile directly with CMake.</p><ol start=2><li><p>Compile</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cmake --build .
</span></span></code></pre></div><p>Note that the preceding <code>..</code> represents the parent directory, the <code>math</code> directory where the <code>CMakeLists.txt</code> file exists, and <code>. </code>represents the current directory, <code>build</code>. If both of these steps are executed successfully, we will be able to harvest a library file in the build directory, which may be called <code>math.dll</code> on Windows platforms and <code>math.so</code> on Linux platforms, but both are dynamic libraries, because that is what we configured in the <code>CMakelists.txt</code> file.</p></li></ol><p>From the above process, CMake&rsquo;s workflow is not complicated. But we are using the default configuration, which means that the final generated library can only be used on the compiled platform. To use CMake to compile Android libraries, we need to manually tell CMake some configurations when generating the project, instead of letting CMake guess.</p><h1 id=cross-compilation-of-cmake class="relative group">Cross-compilation of CMake <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cross-compilation-of-cmake aria-label=Anchor>#</a></span></h1><h2 id=where-do-the-configuration-parameters-come-from class="relative group">Where do the configuration parameters come from? <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#where-do-the-configuration-parameters-come-from aria-label=Anchor>#</a></span></h2><p>Although we do not know what is the minimum configuration to complete the cross-compilation, but we can guess.</p><p>First of all, to complete the compilation of the source code, compiler and linker is indispensable, we also know that the Android platform has a special compiler and linker, so at least one configuration should be to tell CMake with which compiler and linker.</p><p>Secondly, Android&rsquo;s system version and architecture is also essential, after all, for Android development, this is very important for Android applications.</p><p>Can you think of any other parameter, I can&rsquo;t seem to think of any. However, the good news is that Google has done it for us, and that is to use <code>CMAKE--TOOLCHAIIIN_FILE</code> directly. This option is provided by CMake, just set the configuration file path to its value, CMake will find the target file through this path, and use the configuration inside the target file instead of its own guessing parameters. The configuration file is <code>build/camke</code>, one of the two important folders mentioned earlier, and our configuration file is <code>android.toolchain.cmake</code> under that folder.</p><h2 id=the-cmake-of-google class="relative group">The CMake of Google <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-cmake-of-google aria-label=Anchor>#</a></span></h2><p><code>android.toolchain.cmake</code> plays the role of a wrapper that will work together to configure CMake using the parameters provided to it, and the default configuration. In fact, this file is a good source for learning about CMake, and you can learn a lot of CMake tricks. Now, let&rsquo;s not learn CMake-related first, let&rsquo;s see what parameters we have available. In the beginning of the file, Google will be configurable parameters are listed out</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=err>ANDROID_TOOLCHAIN
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_ABI
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_PLATFORM
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_STL
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_PIE
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_CPP_FEATURES
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_ALLOW_UNDEFINED_SYMBOLS
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_ARM_MODE
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_ARM_NEON
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_DISABLE_FORMAT_STRING_CHECKS
</span></span></span><span class=line><span class=cl><span class=err>ANDROID_CCACHE
</span></span></span></code></pre></div><p>These parameters are not actually CMake parameters; they are converted to real CMake parameters as the configuration file is executed. We can specify the values of these parameters to allow CMake to fulfill different build requirements. If you don&rsquo;t specify any of them, the default values will be used, which may be different for different NDK versions.</p><p>Let&rsquo;s focus on the most critical <code>ANDROID_ABI</code> and <code>ANDROID_PLATFORM</code>. The first one refers to which CPU instruction set the currently built package is running on, the available values are <code>arneabi-v7a</code>, <code>arn64-v8a</code>, <code>x86</code>, <code>x86_64</code>, <code>mips</code>, <code>mips64</code>. The latter one refers to the Android version of the build package. Its value takes two forms, one is the direct <code>android-[version]</code> of the form <code>[version]</code> which is replaced with the specific system version when used, e.g., <code>android-23</code>, which means that the minimum supported system version is Android 23. The other form is the string <code>latest</code>. This value is as the word implies, use the latest.</p><p>So how do we know which parameter can take which values? There&rsquo;s an easy way: first identify the parameter you want to see in the header of the file, then search globally and look at the <code>set</code> and <code>if</code> related statements to determine the parameter forms it supports.</p><h2 id=complete-cross-compilation-using-configuration-files class="relative group">Complete cross-compilation using configuration files <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#complete-cross-compilation-using-configuration-files aria-label=Anchor>#</a></span></h2><p>With that out of the way, let&rsquo;s go back to the original example. Now we have <code>CMakelists.txt</code>, we have <code>math.cpp</code>, and we have found the configuration file <code>android.toolchin.cmake</code> for Android. So how do you combine the three, which brings us to CMake&rsquo;s parameter configuration.</p><p>In the previous section, we completed the configuration of the project file generation by directly using the following command</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cmake ..
</span></span></code></pre></div><p>But it is actually possible to pass parameters, <em><strong>CMake&rsquo;s parameters are all key-value pairs that start with <code>-D</code> and are separated by whitespace.</strong></em> And CMake&rsquo;s default parameters all start with <code>CMAKE</code>, so most of the time the parameters are of the form <code>-DCMAKE_XXX</code>For example, passing a <code>toolchain</code> file to CMake would look like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cmake -DCMAKE_TOOLCHAIN_FILE<span class=o>=</span>/home/Andy/Android/Sdk/ndk/21.4.7075529/build/cmake/android.toolchain.cmake
</span></span></code></pre></div><p>The point of this parameter is to tell CMake to use the file specified after <code>=</code> to configure CMake&rsquo;s parameters</p><p>However, to complete the cross-compilation, we are missing one more option - <code>-G</code>. This option is required for cross-compilation. Because cross-compiling CMake does not know what form of project to generate, this option is needed to specify the type of project to generate. One type of project is the traditional Make project, which is specified as follows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cmake -G <span class=s2>&#34;Unix Makefiles&#34;</span>
</span></span></code></pre></div><p>As you can see, this form is based on the Unix Make project, which uses <code>make</code> as the build tool, so after specifying this form, you also need to specify the path to <code>make</code> for the project to be compiled successfully. The other Google-recommended way is <code>Ninja</code>, which is simpler because you don&rsquo;t need to specify the path to <code>Ninja</code> separately, and it is installed in the same directory as CMake by default, so you can reduce the number of passing parameters. <code>Ninja</code> is also a build tool, but focuses on speed, so we&rsquo;ll use <code>Ninja</code> this time. It&rsquo;s specified like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cmake -GNinja
</span></span></code></pre></div><p>Combining the above two parameters gives you the final compilation command</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cmake -GNinja -DCMAKE_TOOLCHAIN_FILE<span class=o>=</span>/home/Andy/Android/Sdk/ndk/21.4.7075529/build/cmake/android.toolchain.cmake ..
</span></span></code></pre></div><p>Generate a project and then compile it</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cmake --build .
</span></span></code></pre></div><p>We&rsquo;ve got a dynamic library that will eventually run on Android. The dynamic library compiled with my version of the NDK supports Android version 21, and the instruction set is armeabi-v7a. Of course, based on the previous description, we can pass the desired parameters as we did earlier with the <code>toolchain</code> file, e.g., to build the <code>x86</code> library with the latest version of Android, you can write something like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cmake -GNinja -DCMAKE_TOOLCHAIN_FILE<span class=o>=</span>/home/Andy/Android/Sdk/ndk/21.4.7075529/build/cmake/android.toolchain.cmake -DANDROID_PLATFORM<span class=o>=</span>latest -DANDROID_ABI<span class=o>=</span>x86 ..
</span></span></code></pre></div><p>This gives us the idea that if some third-party libraries don&rsquo;t provide a compilation guide, but are managed by CMake, we can just apply the above formula to compile the third-party libraries.</p><h1 id=jni class="relative group">JNI <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#jni aria-label=Anchor>#</a></span></h1><p>With the help of CMake, we have got the <code>libmath.so</code> dynamic library, but this library still can&rsquo;t be used directly by Android apps, because Android apps are developed in Java (Kotlin) language, and they are all JVM languages, the code is running on the JVM. To use the library, you also need to find a way to get the library loaded into the JVM and then you can access it. It happens that the JVM really does have this capability, it is JNI.</p><h2 id=jni-basic-concepts class="relative group">JNI basic concepts <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#jni-basic-concepts aria-label=Anchor>#</a></span></h2><p>JNI can provide bi-directional access from Java to C/C++, that is, you can access C/C++ methods or data in Java code, and vice versa, the same support, which is the process of the JVM can not be ignored. So to understand JNI technology, we need to think in terms of JVM.</p><p>JVM is like a goods distribution center, no matter where the goods need to come to this distribution center, and then through it to distribute the goods to the destination. The goods here can be Java methods or C/C++ functions. But unlike ordinary courier is that the goods here do not know where their destination is, you need to find the distribution center itself. Then find the basis from where it is, that is, how to ensure that the distribution center to find the results of the uniqueness of it, the simplest way is, of course, the goods themselves to identify their own, and to ensure its uniqueness.</p><p>Obviously this is a good problem for Java, which has layers of mechanisms to guarantee uniqueness.</p><ol><li>the package name guarantees the uniqueness of the class name;</li><li>the class name can guarantee the uniqueness of the class under the same package name; 3. the method name can guarantee the uniqueness under the same class; and</li><li>method names can be used to guarantee uniqueness under the same class. 4;</li><li>method overloading can be used to determine the uniqueness of the class by the type and number of parameters.</li></ol><p>For C/C++, there is no package name and class name, so can we determine the uniqueness with method name and method parameters? The answer is yes, as long as we use the package name and class name as a kind of qualification.</p><p>There are two ways to add qualifications, one is simple and crude, directly to the package name class name as part of the function name, so that the JVM does not have to look at other things, directly crude package name, class name, function name and parameters of these correspond to determine the corresponding method on the other end. This method is called static registration. In fact, it&rsquo;s very similar to broadcasting in Android: static registration for broadcasting is just brute-force writing in the <code>AndroidManifest</code> file, so you don&rsquo;t have to configure it in the code, and it takes effect as soon as it&rsquo;s written. In contrast to static registration, there must be a dynamic registration method. Dynamic registration is writing code that tells the JVM what functions correspond to each other, rather than having it look them up when the function is called. Obviously the advantage of this approach is that the call is a little faster, after all, we only need to register once, you can in subsequent calls directly access to the counterpart, no longer need to find the operation. However, the same and Android broadcast dynamic registration, dynamic registration is much more cumbersome, and dynamic registration should also pay attention to grasp the timing of registration, otherwise it is easy to cause the call to fail. We continue to <code>libmath.so</code> as an example.</p><h2 id=use-local-library-on-the-java class="relative group">Use local library on the Java <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#use-local-library-on-the-java aria-label=Anchor>#</a></span></h2><p>Accessing C/C++ functions on the Java side is simple, in three steps:</p><ol><li><p>Java calls <code>System.loadLibrary()</code> method to load the library.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>System</span><span class=p>.</span><span class=na>loadlibrary</span><span class=p>(</span><span class=s>&#34;math.so&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>It&rsquo;s worth noting here that CMake generates a dynamic library called <code>libmath.so</code>, but here it&rsquo;s just <code>math.so</code>, which means that you don&rsquo;t need to pass the <code>lib</code> prefix. After this step, the JVM knows that there is a <code>plus</code> function.</p></li><li><p>Java declares a <code>native</code> method that corresponds to a C++ function. Correspondence means that the parameter list and return value should be the same, but the method name can be different.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>native</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>nativePlus</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>left</span><span class=p>,</span><span class=kt>int</span><span class=w> </span><span class=n>right</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>Often, it is customary to prefix <code>native</code> methods with <code>native</code>.</p></li><li><p>Call this <code>native</code> method directly where needed. Calling the method is the same as a normal Java method, passing matching parameters and receiving the return value with the matching type.</p></li></ol><p>Combining these steps into a single class looks like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>hongui.me</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>android.os.Bundle</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>androidx.annotation.Nullable</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>androidx.appcompat.app.AppCompatActivity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>hongui.me.databinding.ActivityMainBinding</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MainActivity</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AppCompatActivity</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>loadLibrary</span><span class=p>(</span><span class=s>&#34;me&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ActivityMainBinding</span><span class=w> </span><span class=n>binding</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>native</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>nativePlus</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>left</span><span class=p>,</span><span class=kt>int</span><span class=w> </span><span class=n>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCreate</span><span class=p>(</span><span class=nd>@Nullable</span><span class=w> </span><span class=n>Bundle</span><span class=w> </span><span class=n>savedInstanceState</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>binding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ActivityMainBinding</span><span class=p>.</span><span class=na>inflate</span><span class=p>(</span><span class=n>getLayoutInflater</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>setContentView</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=na>getRoot</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Example of a call to a native method</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>sampleText</span><span class=p>.</span><span class=na>setText</span><span class=p>(</span><span class=s>&#34;1 + 1 = &#34;</span><span class=o>+</span><span class=n>nativePlus</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=n>1</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=introducing-jni-on-the-cc-side class="relative group">Introducing JNI on the C/C++ side <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#introducing-jni-on-the-cc-side aria-label=Anchor>#</a></span></h2><p>JNI is actually for C/C++ is a layer of adaptation layer, in this layer mainly do the work of function conversion, do not do the implementation of specific functions, so, in general, we will create a new source file, used to deal with the JNI layer of the problem, and the JNI layer of the most important problem is, of course, the method of registration problems mentioned earlier.</p><h3 id=static-registration class="relative group">Static registration <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#static-registration aria-label=Anchor>#</a></span></h3><p>The basic idea of static registration is to write a C/C++ function signature corresponding to an existing Java <code>native</code> method, specifically in four steps.</p><ol><li>Start by writing the exact same function signature as the Java <code>native</code> function</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>int</span> <span class=n>nativePlus</span><span class=p>(</span><span class=kt>int</span> <span class=n>left</span><span class=p>,</span><span class=kt>int</span> <span class=n>right</span><span class=p>)</span>
</span></span></code></pre></div><ol start=2><li>Add the package name and class name in front of the function name. Because package names are split in Java with <code>. </code>split, whereas in C/C++ dots are usually used as function calls, to avoid compilation errors, you need to replace <code>. </code>is replaced with <code>_</code>.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>hongui_me_MainActivity_nativePlus</span><span class=p>(</span><span class=kt>int</span> <span class=n>left</span><span class=p>,</span><span class=kt>int</span> <span class=n>right</span><span class=p>)</span>
</span></span></code></pre></div><ol start=3><li>Converting function parameters. As mentioned earlier all operations are JVM based, and in Java these are natural, but in C/C++ there is no JVM environment, and providing a JVM
environment would have to be in the form of adding parameters. In order to do this, any JNI function has to add two parameters at the beginning of the parameter list. The smallest environment inside Java is a thread, so the first parameter is the thread environment object <code>JNIEnv</code>, which represents the caller&rsquo;s thread environment when calling this function, and this object is the only way for C/C++ to access Java. The second is the calling object. Since you can&rsquo;t call methods directly in Java, you need to call them through a class name or a class, the second argument represents that object or class, which is of type <code>jobjet</code>. Starting from the third parameter, the parameter list corresponds to the Java side, but only just, after all, there are some types that are not available in the C/C++ side, which is the type system in JNI, for our current example the <code>int</code> value in Java corresponds to the <code>jint</code> value in JNI, so the last two parameters are of type <code>jint</code>. This is a critical step, as failure to convert any of the parameters can cause the program to crash.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>hongui_me_MainActivity_nativePlus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>JNIEnv</span><span class=o>*</span> <span class=n>env</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jobject</span> <span class=cm>/* this */</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jint</span> <span class=n>left</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jint</span> <span class=n>right</span><span class=p>)</span>
</span></span></code></pre></div><ol start=4><li>Add the necessary prefixes. This step can be easily overlooked because this part doesn&rsquo;t come so naturally. First we have to add a prefix <code>Java</code> to the function name, which now looks like this <code>Java_hongui_me_MainActivity_nativePlus</code>. Secondly, you need to add <code>JNIEXPORT</code> and <code>JNICALL</code> at the end of the return value, here the return value is <code>jint</code>, so after adding these two macros it looks like this <code>JNIEXPORT jint JNICALL</code>. Finally, you have to add the <code>extern "C" </code>compatibility directive at the beginning. As to why this step is added, interested readers can go to the details, the simple summary is that this is the JNI specification.</li></ol><p>After these four steps, the final version of C/C++ function signature looks like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;math.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=n>JNIEXPORT</span> <span class=n>jint</span> <span class=n>JNICALL</span>
</span></span><span class=line><span class=cl><span class=n>Java_hongui_me_MainActivity_nativePlus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>JNIEnv</span><span class=o>*</span> <span class=n>env</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jobject</span> <span class=cm>/* this */</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jint</span> <span class=n>left</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jint</span> <span class=n>right</span><span class=p>){</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nf>plus</span><span class=p>(</span><span class=n>left</span><span class=p>,</span><span class=n>right</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></div><p>Notice that here I changed the previous <code>math.cpp</code> to <code>math.h</code> and called the function in the JNI adaptation file (filename is <code>native_jni.cpp</code>). So now there are two source files, need to update <code>CMakeList.txt</code> a bit.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=nb>cmake_minimum_required</span><span class=p>(</span><span class=s>VERSION</span> <span class=s>3.18。1</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>project</span><span class=p>(</span><span class=s>math</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>add_library</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>SHARED</span> <span class=s>native_jni.cpp</span><span class=p>)</span><span class=err>
</span></span></span></code></pre></div><p>You can see that we only change the last line of the filename, because <code>CMakeLists.txt</code> is currently located in the directory is also <code>include</code> lookup directory, so do not need to give it a separate value, if you need to add other locations of the header file can be used to <code>include_directories(dir)</code> to add.</p><p>Now use CMake to recompile and generate dynamic libraries, and this time Java will run directly without errors.</p><h3 id=dynamic-registration class="relative group">Dynamic registration <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#dynamic-registration aria-label=Anchor>#</a></span></h3><p>As mentioned earlier dynamic registration needs to pay attention to the timing of registration, so what is considered a good time? In the previous section of Java&rsquo;s use of local libraries, we know that in order to use the library, you must first be loaded, loaded after the success of the JNI methods can be called. Then dynamic registration must occur after loading, before use. JNI is very humane to think of this, in the library after the completion of loading will immediately call <code>jint JNI_OnLoad (JavaVM *vm, void *reserved)</code> function, this method also provides a key <code>JavaVM</code> object, it is simply the best entry point to the dynamic registration of the It&rsquo;s simply the best entry point for dynamic registration. Having determined the timing of the registration, let&rsquo;s now do it in practice. <em><strong>Note: Dynamic registration and static registration are both ways of implementing JNI functions on the C/C++ side, and there is generally only one registration method for the same function.</strong></em> So, the next steps are parallel to static registration, not sequential.</p><p>Dynamic registration in six steps</p><ol><li>Create a new <code>native_jni.cpp</code> file and add the implementation of the <code>JNI_OnLoad()</code> function.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=n>JNIEXPORT</span> <span class=n>jint</span> <span class=n>JNICALL</span>
</span></span><span class=line><span class=cl><span class=n>JNI_OnLoad</span><span class=p>(</span><span class=n>JavaVM</span> <span class=o>*</span><span class=n>vm</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>reserved</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=n>JNI_VERSION_1_6</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This is the standard form and implementation of this function, the previous string are the standard form of JNI function, the key point is the function name and parameters and return value. In order for this function to be called automatically after the library is loaded, the function name must be this, and the parameter form can not be changed, and the final return value to tell the JVM the current JNI version. In other words, these are templates, just copy.</p><ol start=2><li>Get <code>JNIEnv</code> object</li></ol><p>As mentioned earlier, all JNI-related operations are done through the <code>JNIEnv</code> object, but now we only have a <code>JavaVM</code> object, so obviously the secret is in the <code>JavaVM</code>.
The secret lies in the <code>JavaVM</code>. You can get the <code>JNIEnv</code> object through its <code>GetEnv</code> method.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>vm</span><span class=o>-&gt;</span><span class=n>GetEnv</span><span class=p>(</span><span class=n>env</span><span class=p>,</span> <span class=n>JNI_VERSION_1_6</span><span class=p>);</span>
</span></span></code></pre></div><ol start=3><li>Find the target class</li></ol><p>As I said earlier, both dynamic and static registration are most qualified by package and class names, just not in the same way. So for dynamic registration we still have to use the package name and class name, but this time in a different form. Static registration uses <code>_</code> instead of <code>. </code>, this time we&rsquo;re going to use <code>/</code> instead of <code>. </code>. So we end up with a class of the form <code>hongui/me/MainActivity</code>. This is a string form, so how do we convert it to a <code>jclass</code> type in JNI, which is where <code>JNIEnv</code> from step 2 comes in.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>jclass</span> <span class=n>cls</span><span class=o>=</span><span class=n>env</span><span class=o>-&gt;</span><span class=n>FindClass</span><span class=p>(</span><span class=s>&#34;hongui/me/MainActivity&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>This <code>cls</code> object is a one-to-one correspondence with the <code>MainActivity</code> in Java. With the class object the next step is of course the methods.</p><ol start=4><li>Generate an array of JNI function objects.</li></ol><p>Because dynamic registration can register multiple methods of a class at the same time, the registration parameters are in the form of an array, and the type of the array is <code>JNINativeMethod</code>. The purpose of this type is to associate the <code>native</code> method on the Java side with the JNI method, how it is done, look at its structure</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>signature</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span><span class=o>*</span> <span class=n>fnPtr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>JNINativeMethod</span><span class=p>;</span>
</span></span></code></pre></div><ul><li><code>name</code> corresponds to the name of the <code>native</code> method on the Java side, so the value should be <code>nativePlus</code>.</li><li><code>signature</code> corresponds to the parameter list of the <code>native</code> method plus the signature of the function type.</li></ul><p>What is a signature? It is a type shorthand. There are eight basic types in Java, as well as methods, objects, classes. Arrays and so on, all of these things have a set of corresponding string forms, as if it were a hash table, where the keys are string representations of the types, and the values are the corresponding Java types. For example, <code>jint</code> is a true JNI type, its type signature is <code>I</code>, which is the initial capitalization of <code>int</code>.</p><p>Functions also have their own type signature <code>(paramType)returnType</code> Here both <code>paramType</code> and <code>returnType</code> need to be JNI type signatures, with no separator between types.</p><p>In summary, the type signature of <code>nativePlus</code> is <code>(II)I</code>. Two integer arguments return another integer.</p><ul><li><code>fnPtr</code> is, as its name suggests, a function pointer, and the value is our real <code>nativePlus</code> implementation (which we haven&rsquo;t implemented yet here, so let&rsquo;s assume it&rsquo;s <code>jni_plus</code> for now).</li></ul><p>To summarize, the final array of function objects should look like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl> <span class=n>JNINativeMethod</span> <span class=n>methods</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s>&#34;nativePlus&#34;</span><span class=p>,</span><span class=s>&#34;(II)I&#34;</span><span class=p>,</span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=kt>void</span> <span class=o>*&gt;</span><span class=p>(</span><span class=n>jni_plus</span><span class=p>)}</span>
</span></span><span class=line><span class=cl> <span class=p>};</span>
</span></span></code></pre></div><ol start=5><li>Registration</li></ol><p>Now that you have the <code>jclass</code> object representing the class, and the <code>JNINativeMethod</code> array representing the methods, and the <code>JNIEnv</code> object, combine them to complete the registration</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>env</span><span class=o>-&gt;</span><span class=n>RegisterNatives</span><span class=p>(</span><span class=n>cls</span><span class=p>,</span><span class=n>methods</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>methods</span><span class=p>)</span><span class=o>/</span><span class=k>sizeof</span><span class=p>(</span><span class=n>methods</span><span class=p>[</span><span class=mi>0</span><span class=p>]));</span>
</span></span></code></pre></div><p>The third parameter represents the number of methods. We use the <code>sizeof</code> operation to get the size of all the <code>methods</code>, and then we use <code>sizeof</code> to get the size of the first element to get the number of <code>methods</code>. Of course, it&rsquo;s fine to just manually fill in 1 here.</p><ol start=6><li>Implementing JNI Functions</li></ol><p>In step 4, we used a <code>jni_plus</code> to represent the native implementation of <code>nativePlus</code>, but this function hasn&rsquo;t actually been created yet, so we need to define it in the source file. Now the name of the function can be whatever you want, it doesn&rsquo;t have to be as long as the static registration, just keep the final function name the same as the one used in the registration. However, the prefix <code>extern "C"</code> should be added here, to avoid the compiler to do something special with the function name. The argument list is identical to the static registration. So, our final function implementation is as follows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;math.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=n>jint</span> <span class=n>jni_plus</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>JNIEnv</span><span class=o>*</span> <span class=n>env</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jobject</span> <span class=cm>/* this */</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jint</span> <span class=n>left</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>jint</span> <span class=n>right</span><span class=p>){</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=nf>plus</span><span class=p>(</span><span class=n>left</span><span class=p>,</span><span class=n>right</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></div><p>Well, the implementation of dynamic registration is now complete, and after CMake compiles it, you&rsquo;ll see that the result is exactly the same as static registration. So it&rsquo;s up to you to decide what you want and how you want to do it. When you need to call the <code>native</code> method a lot, I think dynamic registration is an advantage, but if you call it very rarely, you can just use static registration, and the lookup consumption is completely negligible.</p><h1 id=one-more-thing class="relative group">One more thing <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#one-more-thing aria-label=Anchor>#</a></span></h1><p>I mentioned earlier that CMake is a master at managing C/C++ projects, but for Android development, Gradle is the way to go. Google realizes this too, so the gradle plugin provides a silky smooth configuration for CMake and Gradle to work seamlessly together directly. Under the <code>android</code> build block, you can directly configure the path and version information of <code>CMakeLists.txt</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>externalNativeBuild</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cmake</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>path</span> <span class=nf>file</span><span class=o>(</span><span class=s1>&#39;src/main/cpp/CMakeLists.txt&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>version</span> <span class=s1>&#39;3.20.5&#39;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></div><p>This way, if you change your C/C++ code or Java code, you can just click run and gradle will compile the libraries and copy them to the final directory, so you don&rsquo;t need to compile and copy the libraries manually anymore. Of course, if you are not satisfied with the default behavior, you can configure the default behavior via <code>defaultConfig</code>, which looks like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>android</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>compileSdkVersion</span> <span class=mi>29</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>defaultConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>minSdkVersion</span> <span class=mi>21</span>
</span></span><span class=line><span class=cl>        <span class=n>targetSdkVersion</span> <span class=mi>29</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>testInstrumentationRunner</span> <span class=s2>&#34;androidx.test.runner.AndroidJUnitRunner&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>consumerProguardFiles</span> <span class=s1>&#39;consumer-rules.pro&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>externalNativeBuild</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>cmake</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>cppFlags</span> <span class=o>+=</span> <span class=s2>&#34;-std=c++1z&#34;</span>
</span></span><span class=line><span class=cl>                <span class=n>arguments</span> <span class=s1>&#39;-DANDROID_STL=c++_shared&#39;</span>
</span></span><span class=line><span class=cl>                <span class=n>abiFilters</span> <span class=s1>&#39;armeabi-v7a&#39;</span><span class=o>,</span> <span class=s1>&#39;arm64-v8a&#39;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Here, <code>cppFlags</code> specifies C++-related arguments, and there&rsquo;s a corresponding <code>cFlags</code> that specifies C-related arguments. <code>arguments</code> is to specify the compilation parameters of CMake, the last one is familiar with the library will eventually be compiled to generate a few architectural packages, we are here just to generate two.</p><p>With these configurations, Android Studio development NDK is exactly like the development of Java, there are intelligent prompts, can be compiled instantly, run instantly, enjoy the silky smooth.</p><h1 id=sumary class="relative group">Sumary <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sumary aria-label=Anchor>#</a></span></h1><p>NDK development should actually be divided into two parts, C++ development and JNI development.
C++ development is exactly the same as C++ development on PC, you can use standard libraries, you can refer to third-party libraries, with the expansion of the project scale, CMake was introduced to manage the project, which has obvious advantages for cross-platform projects, and can also be seamlessly integrated into Gradle.
JNI development is more concerned about the correspondence between the C/C++ side and the Java side, each <code>native</code> method on the Java side should have a corresponding C/C++ function to correspond to it, JNI provides
JNI provides both static registration and dynamic registration to accomplish this work, but the core is to use the package name, class name, function name, and parameter list to determine the uniqueness. Static registration reflects the package name and class name in the function name, while dynamic registration uses the class object, local method object, and <code>JNIENV</code> registration method to achieve uniqueness.
NDK is the big boss behind, it provides compiler, linker and other tools to accomplish cross-compilation, and some system libraries, such as <code>log</code>, <code>z</code>, <code>opengl</code> and so on for us to use directly.</p></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=1000 height=1000 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt="Deep thinking" loading=lazy decoding=async src=/images/logo_hu1444715804356428735.png srcset="/images/logo_hu10122803172005691567.png 330w,/images/logo_hu1444715804356428735.png 660w
,/images/logo.png 1000w
,/images/logo.png 1000w" sizes=100vw></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Deep thinking</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=mailto:honguilee@163.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/hongui target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/en/post/Linux%20batch%20file%20manipulation%20-%20based%20on%20find,xargs.html><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Linux batch file manipulation - based on find,xargs</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-02-18 21:19:39 +0800 +0800">18 February 2022</time>
</span></span></a></span><span><a class="group flex text-right" href=/en/post/Modern%20C++%20Study%20Guide-roadmap.html><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Modern C++ Study Guide-roadmap</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-06-25 08:51:01 +0800 +0800">25 June 2022</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div></footer></article></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2024
Deep thinking</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://bravebuffalo.cc/en/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>