<!doctype html><html lang=zh-cn data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#584394" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.105.0"><link rel="shortcut icon" type=image/x-icon href=/images/icons/favicon.ico><link rel=icon type=image/x-icon href=/images/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/images/icons/favicon_16x16.png><link rel=icon type=image/png sizes=32x32 href=/images/icons/favicon_32_32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon.png><meta itemprop=name content="现代C++学习指南 模板"><meta itemprop=description content="现代C++学习指南 模板"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://hongui.github.io/images/logo.png"><meta itemprop=keywords content="学习指南,C++"><meta property="og:type" content="article"><meta property="og:title" content="现代C++学习指南 模板"><meta property="og:description" content="现代C++学习指南 模板"><meta property="og:image" content="/images/logo.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://hongui.github.io/post/%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%20%E6%A8%A1%E6%9D%BF.html"><meta property="og:site_name" content="低头沉思"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="hongui"><meta property="article:published_time" content="2022-10-31 21:33:38 +0800 +0800"><meta property="article:modified_time" content="2022-10-31 21:33:38 +0800 +0800"><link type=text/css rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://unpkg.com/animate.css@3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://unpkg.com/viewerjs@1.11.0/dist/viewer.min.css><link rel=stylesheet href=/css/main.min.724568d040da1d63a359306ef65ac74d8bf58e4e72c1f88c9ae65e1497de5b62.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%20%E6%A8%A1%E6%9D%BF.html","permalink":"https://hongui.github.io/post/%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%20%E6%A8%A1%E6%9D%BF.html","title":"现代C++学习指南 模板","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.id="LA_COLLECT",e.src="https://sdk.51.la/js-sdk-pro.min.js",e.async="true",e.onload=function(){LA.init({id:"JrJFibzvtRuObfi1",ck:"JrJFibzvtRuObfi1",autoTrack:!0})},document.head.appendChild(e)})</script><title>现代C++学习指南 模板 - 低头沉思</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>低头沉思</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>保持思考</p><img class=custom-logo-image src=/images/logo.png alt=低头沉思></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>15</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><ul><li><a href=#什么是模板>什么是模板</a></li><li><a href=#函数模板>函数模板</a></li><li><a href=#类型推导>类型推导</a></li><li><a href=#类模板>类模板</a></li><li><a href=#特化和偏特化>特化和偏特化</a></li><li><a href=#类型限定>类型限定</a></li><li><a href=#其他问题>其他问题</a></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=hongui src=/imgs/img-lazy-loading.gif data-src=/images/logo.png><p class=site-author-name itemprop=name>hongui</p><div class=site-description itemprop=description>记录生活所思所见。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>15</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>7</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>17</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/hongui title="Github → https://github.com/hongui" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/small/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2021/03/21T15:56:53+08:00></div></div><div id=la-siteinfo-widget style=display:none></div><div class=siteinfo-item><div class=item-name><i class="fa fa-user-plus"></i>今日访问：</div><div class=item-count id=today_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-user-clock"></i>昨日访问：</div><div class=item-count id=yesterday_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-arrows-down-to-people"></i>本月访问：</div><div class=item-count id=month_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-users"></i>总访问量：</div><div class=item-count id=total_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=9762></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=37></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2022/10/31T21:33:38+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/hongui rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://hongui.github.io/post/%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%20%E6%A8%A1%E6%9D%BF.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/images/logo.png"><meta itemprop=name content="hongui"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="hongui"><meta itemprop=description content="记录生活所思所见。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="现代C++学习指南 模板"><meta itemprop=description content="现代C++学习指南 模板"></span><header class=post-header><h1 class=post-title itemprop="name headline">现代C++学习指南 模板</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2022-10-31 21:33:38 +0800 +0800" itemprop="dateCreated datePublished" datetime="2022-10-31 21:33:38 +0800 +0800">2022/10/31</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/c++ itemprop=url rel=index><span itemprop=name>C++</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>6481</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span class=waline-pageview-count data-path=/post/%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%20%E6%A8%A1%E6%9D%BF.html><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><blockquote><p>模板作为C++重要的特性，一直有着举足轻重的地位，是编写高度抽象代码的利器。</p></blockquote><h3 id=什么是模板>什么是模板</h3><p>模板在现实生活中就是范例：把都一样的部分固定起来，把变动的部分空出来，使用时将两部分合起来组成有效的东西。如申请书，Word模板都是这种形式。C++中的模板也是如此，不过更明确的是C++中的模板，变动的部分是一个代指类型的东西，称之为泛型参数。</p><p>我们先从一个例子来看一看模板是怎样发展而来的。如我们需要计算两个对象相加的结果，该如何写代码呢？在写代码前，我们有几个问题需要讨论清楚：
首先我们需要<strong>确定</strong>的是这两个<strong>对象</strong>是什么<strong>类型</strong>，毕竟C++是强类型的编程语言，变量，函数，类都是要明确指定类型是什么的，不确定的类型编译就不能通过。我们先假设这两个类型是整型。确定了类型之后，还需要确定这两个对象需要怎样加起来，根据我们假设的整型，我们知道可以直接调用运算符<code>+</code>。最后我们需要确定，两个对象相加后的结果类型是什么，整型相加的结果也是整型。综上，这个例子的代码看起来可能是这样的</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>sum</span>(<span style=color:#0b0;font-weight:700>int</span> left,<span style=color:#0b0;font-weight:700>int</span> right){
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>	<span style=color:#a2f;font-weight:700>return</span> left <span style=color:#666>+</span> right;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>这个例子很简单，简单到甚至都不需要单独写成一个函数。如果我们需要计算的数据不是两个数，而是一个数组的和呢？基于前面的分析和假设，我们也能很快实现相应的代码</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>sum</span>(<span style=color:#a2f;font-weight:700>const</span> <span style=color:#0b0;font-weight:700>int</span> data[], <span style=color:#a2f;font-weight:700>const</span> std<span style=color:#666>::</span>size_t length) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>	<span style=color:#0b0;font-weight:700>int</span> result{};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>	<span style=color:#a2f;font-weight:700>for</span> (<span style=color:#0b0;font-weight:700>int</span> i <span style=color:#666>=</span> <span style=color:#666>0</span>; i <span style=color:#666>&lt;</span> length;<span style=color:#666>++</span>i) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>		result <span style=color:#666>+=</span> <span style=color:#666>*</span>(data <span style=color:#666>+</span> i);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>	<span style=color:#a2f;font-weight:700>return</span> result;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><p>同样很简单。但是遗憾的是，这个函数通用性不强，它只能计算整型的数组和，假如我们需要计算带有小数点的数组和，它就不灵了，因为第一个参数类型不匹配，尽管我们知道<code>sum</code>的代码几乎都能复用，除了第一行的<code>int</code>需要替换成<code>double</code>。但是不能！我们只能复制一份，然后把<code>int</code>的地方改成<code>double</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0b0;font-weight:700>double</span> <span style=color:#00a000>sum</span>(<span style=color:#a2f;font-weight:700>const</span> <span style=color:#0b0;font-weight:700>double</span> data[], <span style=color:#a2f;font-weight:700>const</span> std<span style=color:#666>::</span>size_t length) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>	<span style=color:#0b0;font-weight:700>double</span> result{};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>	<span style=color:#a2f;font-weight:700>for</span> (<span style=color:#0b0;font-weight:700>int</span> i <span style=color:#666>=</span> <span style=color:#666>0</span>; i <span style=color:#666>&lt;</span> length;<span style=color:#666>++</span>i) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>		result <span style=color:#666>+=</span> <span style=color:#666>*</span>(data <span style=color:#666>+</span> i);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>	<span style=color:#a2f;font-weight:700>return</span> result;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><p>这时你就会发现问题了，<strong>这个过程，我们仅仅改变了类型信息</strong>。这样的问题还会继续增加，我们可能又需要求<code>float</code>的数组和，上面那个<code>double</code>的数组和同样匹配不了，因为<code>float</code>，<code>double</code>是两个类型。正是因为数据类型不一样，所以很多时候我们需要为不同的数据提供相似的代码，这在数据类型膨胀的情况下是很痛苦的，当对算法进行修改的时候我们需要保证所有的数据类型都被修改到，并且要逐个进行测试，这无疑会增加工作量，并放大错误率。但是实际有效的代码都是要明确类型的，如果类型不明确，编译器就没法确定代码是否合法，不确定的事情编译器就要报错，所以按照普通的思路，这个问题是无解的。
但是其实很多时候，这些相似的代码仅仅是数据类型不一样而已，对付这种重复的工作应该让给计算机来完成，也就是编译器。所以我们需要一种技术，让<strong>编译器先不管具体类型是什么，而是用一种特殊的类型来替换，这个类型可以替换成任何类型，用这个特殊的类型完成具体的算法，在使用的时候根据实际的需求，将类型信息提供给算法，让编译器生成满足所提供类型的具体算法，而这就是模板</strong>。这和生活中的模板思想上是共通的。算法是固定的部分，数据类型是可变的部分，两个合起来就是合法的C++代码。也就是利用模板，我们可以只写一个算法，借助编译器生成所有类型的算法，这些算法之间唯一不同的就是类型。
当然光有模板还不够，上面只解决了类型的问题，没有解决算法实现的问题。怎么说呢，如我们有一个需求，需要将数据先排序，再查找最大值。这对于数字（<code>int</code>,<code>float</code>,<code>double</code>等）类型是有效的，直接使用比较运算符（<code>&lt;</code>,<code>></code>）就可以完成了，但是假如想让这个算法适用于自定义类型呢？直接在模板实现中写比较运算符对自定义类型是无效的，因为自定义类型没有实现相对应的比较运算函数。解决方法也很简单，自定义类型实现相对应的比较运算符就行了。诸如此类的问题，在模板中会经常遇到，因为我们对类型的信息一无所知，但是又要确保几乎所有的类型都能正常运作，这就不得不运用各种技术对类型进行限定或者检测，这其实才是模板问题的精髓。所以模板问题不仅仅是类型问题，还是其他C++问题的综合体，需要对C++特性有着较为完整的理解，才能写出有用高效的代码。
C++中通常将模板分为函数模板和模板类，我们先从比较简单的函数模板开始认识。</p><h3 id=函数模板>函数模板</h3><p>函数模板是一种函数，和普通函数不一样的地方是，它的参数列表中至少有一个是不确定类型的。我们用开头的例子来小试牛刀：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;</span><span style=color:#a2f;font-weight:700>typename</span> T<span style=color:#666>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>T sum(<span style=color:#a2f;font-weight:700>const</span> T data[], <span style=color:#a2f;font-weight:700>const</span> std<span style=color:#666>::</span>size_t length) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	T result{};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#a2f;font-weight:700>for</span> (<span style=color:#0b0;font-weight:700>int</span> i <span style=color:#666>=</span> <span style=color:#666>0</span>; i <span style=color:#666>&lt;</span> length;<span style=color:#666>++</span>i) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>		result <span style=color:#666>+=</span> <span style=color:#666>*</span>(data <span style=color:#666>+</span> i);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#a2f;font-weight:700>return</span> result;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	<span style=color:#0b0;font-weight:700>int</span> intData[] <span style=color:#666>=</span> { <span style=color:#666>1</span>, <span style=color:#666>1</span>, <span style=color:#666>2</span>, <span style=color:#666>2</span> };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	<span style=color:#0b0;font-weight:700>float</span> floatData[] <span style=color:#666>=</span> { <span style=color:#666>1</span>, <span style=color:#666>1</span>, <span style=color:#666>2</span>, <span style=color:#666>2</span> };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	<span style=color:#0b0;font-weight:700>double</span> doubleData[] <span style=color:#666>=</span> { <span style=color:#666>1</span>, <span style=color:#666>1</span>, <span style=color:#666>2</span>, <span style=color:#666>2</span> };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	<span style=color:#a2f;font-weight:700>auto</span> len <span style=color:#666>=</span> <span style=color:#a2f;font-weight:700>sizeof</span>(intData)<span style=color:#666>/</span><span style=color:#a2f;font-weight:700>sizeof</span>(intData[<span style=color:#666>0</span>]);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;intSum = &#34;</span> <span style=color:#666>&lt;&lt;</span> sum<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>int</span><span style=color:#666>&gt;</span>(intData,len) <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;, floatSum = &#34;</span> <span style=color:#666>&lt;&lt;</span> sum<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>float</span><span style=color:#666>&gt;</span>(floatData,len) <span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;, doubleSum = &#34;</span> <span style=color:#666>&lt;&lt;</span>sum<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>double</span><span style=color:#666>&gt;</span>(doubleData,len)<span style=color:#666>&lt;&lt;</span>std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#080;font-style:italic>// intSum = 6, floatSum = 6, doubleSum = 6
</span></span></span></code></pre></div><p>在这里，我们仅仅写了一个函数，就可以同时适用于<code>int</code>，<code>float</code>，<code>double</code>。如果还有其它类型实现了默认初始化和运算符<code>+=</code>就同样可以使用这个函数来求和，不需要改动任何现有代码，这就是模板的魅力。
在继续看新东西前，我们先来认识一下函数模板和普通函数之间有什么不同：</p><ol><li>函数模板需要一个模板头，即<code>template&lt;typename T></code>。它的作用是告诉编译器下面的函数中遇到<code>T</code>的地方都不是具体类型，需要在调用函数时再确定。</li><li>函数声明中，类型位置被<code>T</code>替代了，也就是说<code>T</code>是一个占位类型，可以将它当作普通类型来用。在写模板代码时，这是很有用的。</li></ol><p>再来看使用函数的地方，也就是类似<code>sum&lt;xxx>(xxxData,len)</code>的语句，其中的<code>xxx</code>代表数据类型，也就是函数模板中<code>T</code>的实际类型。简单来说就告诉编译器，用类型<code>xxx</code>替换函数模板中的类型<code>T</code>，这个过程有个官方的名字，<strong>实例化</strong>,这是另一个和普通函数不一样的地方.。用函数模板是需要经过两个步骤的。</p><ol><li>定义模板。这一步没有具体类型，需要使用一个泛型参数来对类型占位，也就是只要是出现实际类型的地方，都要使用泛型参数来占位，并用这个泛型参数来实现完整的算法。这一步编译器由于不知道具体类型，不会对一些类型操作进行禁止，而只是检查标识符是否存在，语法是否合法等。</li><li>实例化。实例化的过程只会发生在开发者调用函数模板的地方，没有实例化的函数模板的代码是不会出现在最执行文件中的。编译器会对每一处发生实例化的地方，用实际参数来替换泛型参数，并检查实际类型是否支持算法中所有的操作，如果不支持，则编译失败，需要开发者实现相关的操作或者修改函数模板。如上例中，假如我们用一个自定义类型来实例化，就会发现编译无法通过，因为自定义类型没有定义操作符<code>+=</code>（除非该操作符已经被定义了），这个过程就发生在实例化。解决方案也很简单，对自定义类型添加操作符<code>+=</code>即可。</li></ol><h3 id=类型推导>类型推导</h3><p>在上例中，我们发现在实例化的过程中，要同时给函数模板传递类型参数和数据参数，并且类型参数往往和数据的类型是一一对应的，这中冗杂的语法对于现代C++来说是不可接受的，所以现代C++编译器都支持类型推导。类型推导可以让开发者省略类型参数，直接根据数据类型来推导出类型参数，所以上例实例化都可以写成<code>sum(xxxData,len)</code>的形式，编译器能分别推导出<code>xxx</code>的类型是<code>int</code>,<code>float</code>，<code>double</code>。
当然类型推导也不是万能的，我们来看下面这个例子</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;</span><span style=color:#a2f;font-weight:700>typename</span> T<span style=color:#666>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>T max(T a, T b) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	<span style=color:#a2f;font-weight:700>return</span> a <span style=color:#666>&gt;</span> b <span style=color:#666>?</span> <span style=color:#a0a000>a</span> : b;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	<span style=color:#0b0;font-weight:700>int</span> a <span style=color:#666>=</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#0b0;font-weight:700>int</span> b <span style=color:#666>=</span> <span style=color:#666>2</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;max(&#34;</span> <span style=color:#666>&lt;&lt;</span> a <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;,&#34;</span><span style=color:#666>&lt;&lt;</span>b<span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;) = &#34;</span> <span style=color:#666>&lt;&lt;</span>max(a,b) <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#080;font-style:italic>// max(1,2) = 2
</span></span></span></code></pre></div><p>这个例子很直观，结果当然也毫无意外。现在我们要变形了：我们把变量<code>b</code>的类型改为<code>float</code>，就会发现编译无法通过了。提示我们数据类型不匹配，因为<code>a</code>是<code>int</code>，<code>b</code>是<code>float</code>，所以推导出的结果就是<code>max&lt;int,float>()</code>，而实际上我们是只有一个类型参数的。
那既然问题很明了，解决方法也似乎很简单，给<code>max</code>再加一个参数不就行了吗？我们来看一看。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;</span><span style=color:#a2f;font-weight:700>typename</span> A,<span style=color:#a2f;font-weight:700>typename</span> B<span style=color:#666>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>A max(A a, B b) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	<span style=color:#a2f;font-weight:700>return</span> a <span style=color:#666>&gt;</span> b <span style=color:#666>?</span> <span style=color:#a0a000>a</span> : b;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	<span style=color:#0b0;font-weight:700>int</span> a <span style=color:#666>=</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#0b0;font-weight:700>float</span> b <span style=color:#666>=</span> <span style=color:#666>2</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;max(&#34;</span> <span style=color:#666>&lt;&lt;</span> a <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;,&#34;</span><span style=color:#666>&lt;&lt;</span>b<span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;) = &#34;</span> <span style=color:#666>&lt;&lt;</span>max(a,b) <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#080;font-style:italic>// max(1,2) = 2
</span></span></span></code></pre></div><p>经过这样改之后，编译和运行都不报错了，问题似乎解决了，是吗？
并不是，我们把<code>float b = 2;</code>换成<code>float b = 2.5;</code>，</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>	<span style=color:#0b0;font-weight:700>int</span> a <span style=color:#666>=</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>	<span style=color:#0b0;font-weight:700>float</span> b <span style=color:#666>=</span> <span style=color:#666>2.5</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;max(&#34;</span> <span style=color:#666>&lt;&lt;</span> a <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;,&#34;</span><span style=color:#666>&lt;&lt;</span>b<span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;) = &#34;</span> <span style=color:#666>&lt;&lt;</span>max(a,b) <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#080;font-style:italic>// max(1,2.5) = 2
</span></span></span></code></pre></div><p>再次运行程序，就会发现输出是错误的了。因为函数模板中，我们把返回值定义成了<code>A</code>，在实例化的时候<code>A</code>被推导成了<code>int</code>类型，所以实际上<code>max</code>的返回值就成了<code>int</code>类型，最大值<code>B</code>就被从<code>float</code>强制转换成了<code>int</code>类型，丢失了数据精度。那有没有解决方法呢？有的，而且不止一种!
根据上面的分析，其问题的根本是数据被强转了，解决方案当然就是阻止它发生强转，也就是保持两种数据类型是一致的，那怎么保证呢？阻止编译器的类型推导，手动填写类型参数。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>	<span style=color:#0b0;font-weight:700>int</span> a <span style=color:#666>=</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>	<span style=color:#0b0;font-weight:700>float</span> b <span style=color:#666>=</span> <span style=color:#666>2.5</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;max(&#34;</span> <span style=color:#666>&lt;&lt;</span> a <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;,&#34;</span><span style=color:#666>&lt;&lt;</span>b<span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;) = &#34;</span> <span style=color:#666>&lt;&lt;</span>max<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>float</span><span style=color:#666>&gt;</span>(a,b) <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#080;font-style:italic>// max(1,2.5) = 2.5
</span></span></span></code></pre></div><p>可以看到在此例中，我们只填写了一个类型参数，因为类型<code>B</code>会自动推导成<code>float</code>。没错，类型推导是可以部分禁用的！
另一种解决方案就是完全让编译器计算类型。怎么计算呢，C++11提供了<code>auto</code>和<code>decltype</code>。<code>auto</code>可以计算变量的类型，<code>decltype</code>可以计算表达式的类型，用法如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a2f;font-weight:700>auto</span> a<span style=color:#666>=</span><span style=color:#666>1</span>; <span style=color:#080;font-style:italic>// a被推导成int类型
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>auto</span> b<span style=color:#666>=</span><span style=color:#666>1.5</span>; <span style=color:#080;font-style:italic>// b被推导成double类型
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>decltype</span>(a<span style=color:#666>+</span>b) <span style=color:#080;font-style:italic>//结果是double类型
</span></span></span></code></pre></div><p>也就是可以将返回值置为<code>auto</code>，然后让编译器决定返回类型</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;</span><span style=color:#a2f;font-weight:700>typename</span> A,<span style=color:#a2f;font-weight:700>typename</span> B<span style=color:#666>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#a2f;font-weight:700>auto</span> max(A a, B b) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	<span style=color:#a2f;font-weight:700>return</span> a <span style=color:#666>&gt;</span> b <span style=color:#666>?</span> <span style=color:#a0a000>a</span> : b;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	<span style=color:#0b0;font-weight:700>int</span> a <span style=color:#666>=</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#0b0;font-weight:700>float</span> b <span style=color:#666>=</span> <span style=color:#666>2.5</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;max(&#34;</span> <span style=color:#666>&lt;&lt;</span> a <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;,&#34;</span><span style=color:#666>&lt;&lt;</span>b<span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;) = &#34;</span> <span style=color:#666>&lt;&lt;</span>max<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>float</span><span style=color:#666>&gt;</span>(a,b) <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#080;font-style:italic>// max(1,2.5) = 2.5
</span></span></span></code></pre></div><p>假如编译器只支持C++11的话，会麻烦一点，不仅要前置<code>auto</code>，在函数头后还要使用<code>decltype</code>来计算返回类型，这个特性称为<strong>尾返回推导。</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;</span><span style=color:#a2f;font-weight:700>typename</span> A,<span style=color:#a2f;font-weight:700>typename</span> B<span style=color:#666>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#a2f;font-weight:700>auto</span> max(A a, B b)<span style=color:#666>-&gt;</span><span style=color:#a2f;font-weight:700>decltype</span>(a <span style=color:#666>+</span> b) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>	<span style=color:#a2f;font-weight:700>return</span> a <span style=color:#666>&gt;</span> b <span style=color:#666>?</span> <span style=color:#a0a000>a</span> : b;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span></code></pre></div><p>这里<code>decltype</code>里面写的是
函数模板暂时放一放，我们来看一看类模板是怎样的。</p><h3 id=类模板>类模板</h3><p>和函数模板一样，类模板也至少包含一个泛型参数，这个泛型参数的作用域是整个类，也就是说可以使用这个泛型参数定义成员变量和成员函数。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;</span><span style=color:#a2f;font-weight:700>typename</span> T<span style=color:#666>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#a2f;font-weight:700>class</span> <span style=color:#00f>Result</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	T data;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#0b0;font-weight:700>int</span> code;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	std<span style=color:#666>::</span>string reason;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#a2f;font-weight:700>public</span><span style=color:#666>:</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	Result(T data, <span style=color:#0b0;font-weight:700>int</span> code <span style=color:#666>=</span> <span style=color:#666>0</span>, std<span style=color:#666>::</span>string reason <span style=color:#666>=</span> <span style=color:#b44>&#34;success&#34;</span>) <span style=color:#666>:</span>data{ data }, code{ code }, reason{ reason } {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	<span style=color:#a2f;font-weight:700>friend</span> std<span style=color:#666>::</span>ostream<span style=color:#666>&amp;</span> <span style=color:#a2f;font-weight:700>operator</span><span style=color:#666>&lt;&lt;</span>(std<span style=color:#666>::</span>ostream<span style=color:#666>&amp;</span> os, <span style=color:#a2f;font-weight:700>const</span> Result result) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>		os <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;Result(data = &#34;</span> <span style=color:#666>&lt;&lt;</span> result.data <span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;, code = &#34;</span> <span style=color:#666>&lt;&lt;</span> result.code <span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;, reason = &#34;</span> <span style=color:#666>&lt;&lt;</span> result.reason <span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;)&#34;</span> <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>		<span style=color:#a2f;font-weight:700>return</span> os;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	Result<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>int</span><span style=color:#666>&gt;</span> result{ <span style=color:#666>9527</span> };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> result <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#080;font-style:italic>// Result(data = 9527, code = 0, reason = success)
</span></span></span></code></pre></div><p>可以看到，类模板和普通类类似，普通类有的它都有——成员函数，成员变量，构造函数等等，值得一说的依然是这个泛型参数<code>T</code>。上例是SDK中常见的数据类，用于指示操作是否成功并且必要时返回操作结果。对于返回一般数据类型，这个类已经足够了，但是假如我们的某个接口无返回值，按照传统即返回<code>void</code>类型，问题出现了。<code>data</code>的实际类型是<code>void</code>，但是我们找不到任何值来初始化它。更进一步，返回<code>void</code>的时候，我们根本不需要<code>data</code>这个成员变量。为了解决类似这种问题，模板提供了特化。</p><h3 id=特化和偏特化>特化和偏特化</h3><p><strong>特化就是用特定类型替代泛型参数重新实现类模板或者函数模板，它依赖于原始模板</strong>。如上例中，我们已经有了原始模板类<code>Result&lt;T></code>，为了解决<code>void</code>不能使用的情况，我们需要为<code>void</code>类型重新定义一个<code>Result</code>，即<code>Result&lt;void></code>，则<code>Result&lt;void></code>就称为<code>Result&lt;T></code>的一种特化，原来的<code>Result&lt;T></code>称为原始模板类。这样的特化版本可以有很多个，一个类型就是一个特化版本，它<strong>完美融合了通用性和特殊性两个优势</strong>。当实例化过程中，如果实例化类型和特化类型一致，则实例化将使用特化的那个类（函数）来完成，如下面的例子</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#080;font-style:italic>// Result定义保持不变，新增特化版本
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#a2f;font-weight:700>class</span> <span style=color:#00f>Result</span><span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#0b0;font-weight:700>int</span> code;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	std<span style=color:#666>::</span>string reason;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#a2f;font-weight:700>public</span><span style=color:#666>:</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	Result(<span style=color:#0b0;font-weight:700>int</span> code <span style=color:#666>=</span> <span style=color:#666>0</span>, std<span style=color:#666>::</span>string reason <span style=color:#666>=</span> <span style=color:#b44>&#34;success&#34;</span>)<span style=color:#666>:</span> code{ code }, reason{ reason }{}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#a2f;font-weight:700>friend</span> std<span style=color:#666>::</span>ostream<span style=color:#666>&amp;</span> <span style=color:#a2f;font-weight:700>operator</span><span style=color:#666>&lt;&lt;</span>(std<span style=color:#666>::</span>ostream<span style=color:#666>&amp;</span> os, <span style=color:#a2f;font-weight:700>const</span> Result result) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>		os <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;Result(&#34;</span><span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;code = &#34;</span> <span style=color:#666>&lt;&lt;</span> result.code <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;, reason = &#34;</span> <span style=color:#666>&lt;&lt;</span> result.reason <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;)&#34;</span> <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>		<span style=color:#a2f;font-weight:700>return</span> os;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>	Result<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span> voidResult;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	Result<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>int</span><span style=color:#666>&gt;</span> intResult{<span style=color:#666>9527</span>};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;void = &#34;</span><span style=color:#666>&lt;&lt;</span> voidResult<span style=color:#666>&lt;&lt;</span>std<span style=color:#666>::</span>endl<span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;int = &#34;</span> <span style=color:#666>&lt;&lt;</span> intResult <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#080;font-style:italic>// void = Result(code = 0, reason = success)
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#080;font-style:italic>// int = Result(data = 9527, code = 0, reason = success)
</span></span></span></code></pre></div><p>可以看到，当实例化为<code>int</code>类型时，使用的是原始的模板类。而当实例化为<code>void</code>类型时，使用的是特化的版本。
除了特化，还有<strong>偏特化</strong>。偏特化和特化很像，就是对类型进行一个更窄的限定，使之适用于某一类类型，如<code>const</code>，指针，引用等。或者对有多个泛型参数的类进行部分特化。
特化和偏特化是对模板特殊类型的补充，解决的是模板实现上的一些问题。很多时候如果通用模板不好实现，可以考虑使用特化。当然，特化版本越多，模板的维护成本就越高，这时候就该考虑是否是设计上存在缺陷了。</p><h3 id=类型限定>类型限定</h3><p>C++模板的强大不仅仅表现在对类型的操作上，有时候为了防止我们的类被滥用，我们还需要对这些能力做一些限定，比如禁止某些特定的类型实例化。
在上面的例子中，假设我们规定<code>Result</code>必须返回实际的数据，禁止<code>void</code>实例化该怎么做呢？容易想到的是，我们首先需要一种方法<strong>判断实例化时的类型是否是特定类型</strong>，然后需要在<strong>实例化类型是禁止类型时告诉编译器编译失败</strong>。所有的这些，标准库<code>type_traits</code>都提供了支持。它提供了一系列工具来帮助我们识别类型参数，如数字，字符串，指针等等，也提供了一些其他工具辅助这些类型参数工具完成更复杂的功能。
此例中，我们希望实例化类型不能是<code>void</code>，经过查找<code>type_traits</code>，我们发现有个<code>is_void</code>的类，它有个<code>value</code>常量，这个常量在类型参数为<code>void</code>是为<code>true</code>，否则为<code>false</code>。当然有了判定方法还不够，我们还需要在类型不匹配时让编译器报错的方法，恰好，我们有<code>enable_if_t</code>。它有两个类型参数，第一个是布尔表达式，第二个是类型参数。当表达式为真时，类型参数才有定义，否则编译失败。所以为了完成禁止<code>void</code>实例化的功能，我们需要借助两个工具，<code>is_void</code>判断类型参数是否是<code>void</code>,<code>enable_if_t</code>完成布尔表达式到类型参数的转换。综上，让我们来看看实现：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;</span><span style=color:#a2f;font-weight:700>typename</span> T<span style=color:#666>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#a2f;font-weight:700>class</span> <span style=color:#00f>Result</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	std<span style=color:#666>::</span>enable_if_t<span style=color:#666>&lt;!</span>std<span style=color:#666>::</span>is_void<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;::</span>value,T<span style=color:#666>&gt;</span> data;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#0b0;font-weight:700>int</span> code;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	std<span style=color:#666>::</span>string reason; 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#a2f;font-weight:700>public</span><span style=color:#666>:</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	Result(std<span style=color:#666>::</span>enable_if_t<span style=color:#666>&lt;</span> <span style=color:#666>!</span>std<span style=color:#666>::</span>is_void<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;::</span>value,T<span style=color:#666>&gt;</span> data, <span style=color:#0b0;font-weight:700>int</span> code <span style=color:#666>=</span> <span style=color:#666>0</span>, std<span style=color:#666>::</span>string reason <span style=color:#666>=</span> <span style=color:#b44>&#34;success&#34;</span>) <span style=color:#666>:</span>data{ data }, code{ code }, reason{ reason } {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	<span style=color:#a2f;font-weight:700>friend</span> std<span style=color:#666>::</span>ostream<span style=color:#666>&amp;</span> <span style=color:#a2f;font-weight:700>operator</span><span style=color:#666>&lt;&lt;</span>(std<span style=color:#666>::</span>ostream<span style=color:#666>&amp;</span> os, <span style=color:#a2f;font-weight:700>const</span> Result<span style=color:#666>&lt;</span> std<span style=color:#666>::</span>enable_if_t<span style=color:#666>&lt;</span> <span style=color:#666>!</span>std<span style=color:#666>::</span>is_void<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;::</span>value, T<span style=color:#666>&gt;&gt;</span> result) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>		os <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;Result(data = &#34;</span> <span style=color:#666>&lt;&lt;</span> result.data <span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;, code = &#34;</span> <span style=color:#666>&lt;&lt;</span> result.code <span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;, reason = &#34;</span> <span style=color:#666>&lt;&lt;</span> result.reason <span style=color:#666>&lt;&lt;</span><span style=color:#b44>&#34;)&#34;</span> <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>		<span style=color:#a2f;font-weight:700>return</span> os;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>};
</span></span></code></pre></div><p>例中，第3行和第8行都用到了类型限定，其实我们只需要在构造函数是对<code>T</code>限定就可以了。当用<code>void</code>来实例化<code>Result</code>时，将无法通过编译。</p><h3 id=其他问题>其他问题</h3><p>C++模板有两方面的问题要解决，一方面是本身模板相关的问题，而另一方面就是和其他特性一起工作。如C++11引入了右值引用，但是右值引用通过参数传递以后会造成引用坍缩，丢失其右值引用的性质，表现得像一般引用类型，为了解决这个问题，C++提供了<code>std::move</code>工具。这对于普通函数是没问题的，但是假如这是一个模板函数呢？C++同样提供了<strong>完美转发</strong>的解决方法。
所谓完美转发，就是让右值引用保持右值引用，左值引用也保持左值引用。它需要配合万能引用一起使用。万能引用和右值引用很相似，只不过<strong>万能引用类型是不确定的，在编译期才能确定</strong>。看下面的例子</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>template</span> <span style=color:#666>&lt;</span><span style=color:#a2f;font-weight:700>typename</span> T<span style=color:#666>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#0b0;font-weight:700>void</span> test(T<span style=color:#666>&amp;&amp;</span> p) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	std<span style=color:#666>::</span>cout <span style=color:#666>&lt;&lt;</span> <span style=color:#b44>&#34;p = &#34;</span> <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>forward<span style=color:#666>&lt;</span>T<span style=color:#666>&gt;</span>(p) <span style=color:#666>&lt;&lt;</span> std<span style=color:#666>::</span>endl;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#0b0;font-weight:700>int</span> a <span style=color:#666>=</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	test(a);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	test(std<span style=color:#666>::</span>move(a));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	<span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#080;font-style:italic>// 输出
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#080;font-style:italic>// p = 1
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#080;font-style:italic>// p = 1
</span></span></span></code></pre></div><p><code>T&&</code>是万能引用，因为它类型不确定，然后通过<code>std::forward&lt;></code>转发参数。可以看到在8，9行，我们成功传递给<code>test</code>左值和右值，并且也成功得到了预期结果，不需要为右值单独写函数来处理。模板的这个功能极大简化了函数的设计，对于API的设计来说简直就是救星。
此外，函数模板还有重载的问题。通常来说普通函数的优先级会高于函数模板的优先级，函数模板之间越特殊的会优先匹配等等。这些问题随着对模板了解的深入，会慢慢出现，但是在学习初期没必要花费太多精力来了解这些特性，一切以实用为主。</p><h3 id=总结>总结</h3><p>模板是C++中很大的一个课题，融合了类型系统，标准库，类等一系列的大课题。所以写出完美的模板代码需要首先对这些课题有较为完整的了解。其次由于模板对类型控制较为宽松，还需要开发者对模板的适用范围有全局的把控，禁止什么，对什么类型需要特殊化处理，都要考虑到位，稍不注意就会隐藏一个难以察觉的bug。
总之就是一句话，模板是常学常新，常用常新的，需要在实践中学习，又要在学习中实践的东西，祝大家每次都有新收获！</p><h3 id=参考资料>参考资料</h3><ol><li><a href=https://en.cppreference.com/w/cpp/meta#Type_traits title=type_traints rel="noopener external nofollow noreferrer" target=_blank class=exturl>type_traints
<i class="fa fa-external-link-alt"></i></a></li></ol></div><footer class=post-footer><div class=post-tags><a href=/tags/%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97>学习指南</a>
<a href=/tags/c++>C++</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
现代C++学习指南 模板</li><li class=post-copyright-author><strong>原文作者：</strong>
hongui</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://hongui.github.io/post/%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%20%E6%A8%A1%E6%9D%BF.html title="现代C++学习指南 模板">https://hongui.github.io/post/%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%20%E6%A8%A1%E6%9D%BF.html</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"></div><div class="post-nav-prev post-nav-item"><a href=/post/%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97-%E6%A0%87%E5%87%86%E5%BA%93.html rel=prev title=现代C++学习指南-标准库>现代C++学习指南-标准库
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>hongui</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.105.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.4.0 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div></div></footer><script type=text/javascript src=https://unpkg.com/animejs@3.2.1/lib/anime.min.js defer></script>
<script type=text/javascript src=https://unpkg.com/viewerjs@1.11.0/dist/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#584394","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://hongui.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lawidget":{"id":"JrJFibzvtRuObfi1","js":"https://v6-widget.51.la/v6/laId/quote.js?theme=0\u0026col=true\u0026f=12\u0026display=0,0,0,1,0,1,1,1"},"lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"always","offset":8,"padding":16,"position":"left","width":240},"statis":{"enable":true,"plugin":"51la"},"vendor":{"plugins":"unpkg","router":"https://unpkg.com"},"version":"4.4.0","waline":{"cfg":{"emoji":false,"imguploader":false,"pageview":"#waline-pageview-count","placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.08bda9e4524cd731736163563f52818b7194694c2486534cc8a72a94c7209862.js defer></script></body></html>