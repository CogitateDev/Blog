<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#584394" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.113.0"><link rel="shortcut icon" type=image/x-icon href=/images/icons/favicon.ico><link rel=icon type=image/x-icon href=/images/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/images/icons/favicon_16x16.png><link rel=icon type=image/png sizes=32x32 href=/images/icons/favicon_32_32.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon.png><meta itemprop=name content="Android-OpenGLES学习-画个颜色"><meta itemprop=description content="Android-OpenGLES学习-画个颜色"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://hongui.github.io/images/logo.png"><meta itemprop=keywords content="学习指南,Android,OpenGL ES"><meta property="og:type" content="article"><meta property="og:title" content="Android-OpenGLES学习-画个颜色"><meta property="og:description" content="Android-OpenGLES学习-画个颜色"><meta property="og:image" content="/images/logo.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://hongui.github.io/post/Android-OpenGLES%E5%AD%A6%E4%B9%A0-%E7%94%BB%E4%B8%AA%E9%A2%9C%E8%89%B2.html"><meta property="og:site_name" content="低头沉思"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="hongui"><meta property="article:published_time" content="2023-05-09 22:14:38 +0800 +0800"><meta property="article:modified_time" content="2023-05-09 22:14:38 +0800 +0800"><link type=text/css rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://unpkg.com/animate.css@3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://unpkg.com/viewerjs@1.11.0/dist/viewer.min.css><link rel=stylesheet href=/css/main.min.724568d040da1d63a359306ef65ac74d8bf58e4e72c1f88c9ae65e1497de5b62.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"Android-OpenGLES%E5%AD%A6%E4%B9%A0-%E7%94%BB%E4%B8%AA%E9%A2%9C%E8%89%B2.html","permalink":"https://hongui.github.io/post/Android-OpenGLES%E5%AD%A6%E4%B9%A0-%E7%94%BB%E4%B8%AA%E9%A2%9C%E8%89%B2.html","title":"Android-OpenGLES学习-画个颜色","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.id="LA_COLLECT",e.src="https://sdk.51.la/js-sdk-pro.min.js",e.async="true",e.onload=function(){LA.init({id:"JrJFibzvtRuObfi1",ck:"JrJFibzvtRuObfi1",autoTrack:!0})},document.head.appendChild(e)})</script><title>Android-OpenGLES学习-画个颜色 - 低头沉思</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>低头沉思</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>保持思考</p><img class=custom-logo-image src=/images/logo.png alt=低头沉思></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>16</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><ul><li><a href=#opengl-es>OpenGL ES</a></li><li><a href=#工作流程>工作流程</a><ul><li><a href=#准备环境>准备环境</a></li><li><a href=#准备着色器>准备着色器</a></li><li><a href=#准备程序>准备程序</a></li><li><a href=#渲染>渲染</a></li><li><a href=#上屏>上屏</a></li><li><a href=#清理>清理</a></li></ul></li><li><a href=#实例上手>实例上手</a></li><li><a href=#egl>EGL</a></li><li><a href=#准备egldisplay>准备EGLDisplay</a></li><li><a href=#获取配置>获取配置</a></li><li><a href=#配置显示区域>配置显示区域</a></li><li><a href=#将它们连起来>将它们连起来</a></li><li><a href=#进入opengl-es世界>进入OpenGL ES世界</a></li><li><a href=#上屏-1>上屏</a></li><li><a href=#总结>总结</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=hongui src=/imgs/img-lazy-loading.gif data-src=/images/logo.png><p class=site-author-name itemprop=name>hongui</p><div class=site-description itemprop=description>记录生活所思所见。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>16</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>8</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>18</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/hongui title="Github → https://github.com/hongui" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/small/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2021/03/21T15:56:53+08:00></div></div><div id=la-siteinfo-widget style=display:none></div><div class=siteinfo-item><div class=item-name><i class="fa fa-user-plus"></i>今日访问：</div><div class=item-count id=today_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-user-clock"></i>昨日访问：</div><div class=item-count id=yesterday_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-arrows-down-to-people"></i>本月访问：</div><div class=item-count id=month_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-users"></i>总访问量：</div><div class=item-count id=total_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=14879></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=48></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023/05/09T22:14:38+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/hongui rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://hongui.github.io/post/Android-OpenGLES%E5%AD%A6%E4%B9%A0-%E7%94%BB%E4%B8%AA%E9%A2%9C%E8%89%B2.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/images/logo.png"><meta itemprop=name content="hongui"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="hongui"><meta itemprop=description content="记录生活所思所见。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Android-OpenGLES学习-画个颜色"><meta itemprop=description content="Android-OpenGLES学习-画个颜色"></span><header class=post-header><h1 class=post-title itemprop="name headline">Android-OpenGLES学习-画个颜色</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2023-05-09 22:14:38 +0800 +0800" itemprop="dateCreated datePublished" datetime="2023-05-09 22:14:38 +0800 +0800">2023/05/09</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/opengl-es itemprop=url rel=index><span itemprop=name>OpenGL ES</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>5117</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span class=waline-pageview-count data-path=/post/Android-OpenGLES%E5%AD%A6%E4%B9%A0-%E7%94%BB%E4%B8%AA%E9%A2%9C%E8%89%B2.html><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><blockquote><p>我们知道屏幕显示出内容是靠一个一个发光的RGB灯珠，而决定灯珠亮度的是一块内存区域，通过往这一块内存区域写入数据，我们就能在屏幕上观察到数据显示效果。这是个复杂又灵活的工作，为了方便完成这项工作，先驱们制定出了OpenGL标准，我们的故事也将从这里开始。</p></blockquote><h3 id=opengl-es>OpenGL ES</h3><p>OpenGL ES是OpenGL的精简版本，Android平台从发行伊始就提供了OpenGL ES的支持，只是不同的版本，支持的OpenGL ES版本不同，目前主流的版本还是2.0和3.0。OpenGL ES是一组API，为开发者提供配置数据，传输数据，绘制内容的能力。它的工作是和绘制严格相关的，所以光是OpenGL ES不会造成很大的理解障碍，问题出在配置OpenGL ES的配置环境上。为什么要将OpenGL ES API和配置环境分开呢，因为OpenGL ES是跨平台的API，但是实际运行的时候需要和特定平台绑定，如Android。平台间准备OpenGL ES环境所需要的条件不同，为了保证OpenGL ES的跨平台能力，就需要将配置环境单独拿出来和特定平台绑定。在Android上这个配置环境就是EGL。明确OpenGL ES API和配置OpenGL ES环境的区别不仅对理解这两个关键概念有很大帮助，更是对后期调试代码，排错帮助极大。</p><h3 id=工作流程>工作流程</h3><p>明确了一些基本概念之后，我们接下来最重要的任务是理清OpenGL ES的工作流程。很多教程一上来就列举一大堆名词或者直接上实例，我觉得是不妥的。只有熟悉了工作流程，我们在写代码的时候才能做到心中有数，才能在排错过程中更快更准确地定位问题。</p><h4 id=准备环境>准备环境</h4><p>OpenGL ES是由一系列API组成的，但是不代表可以在任何时机下调用这些API，而是需要运行环境进行一些设置，这就是准备环境。准备环境通常是做一些显存分配，窗口配置的工作，很繁琐却必不可少。</p><h4 id=准备着色器>准备着色器</h4><p>着色器很重要，但是对于初学者来说不需要用太多的精力来关注它，很多效果直接可以在网上找到现成的代码，但是怎样将这些代码组装成一个完整可运行的程序却不一定有。我们只需要明确着色器是OpenGL ES开发中的重要一环，这一环这一是魔法发生的地方。</p><h4 id=准备程序>准备程序</h4><p>着色器虽然重要，但是也不能独立运行，需要由一个程序管理。这里说的程序是一个OpenGL ES对象，它负责将着色器组装在一起。在运行大部分OpenGL ES API前都需要先使用到这个对像。</p><h4 id=渲染>渲染</h4><p>渲染环节其实也是在准备数据，我们需要将着色器中用到的一些数据赋值，然后调用绘制API，完成最后的绘制工作。GPU会将数据传递给着色器，着色器经过流水线，将数据转换成最终的显示数据存储在显存中。</p><h4 id=上屏>上屏</h4><p>渲染不代表就是将数据显示出来了，而是说数据计算好了。计算好的数据要想在屏幕上看到，可能需要调用OpenGL ES环境配置工具中的某个函数，如交换缓冲或者切换显示对象。</p><h4 id=清理>清理</h4><p>和内存一样，我们使用OpenGL ES API也会申请到一些资源，在渲染结束后，我们应该主动将资源释放，以便后续程序使用。很多时候我们正常申请资源没有成功，可能是前面有资源没有释放的原因。</p><p>以上就是开发OpenGL ES应用的大致流程。由于OpenGL ES开发不好排错，所以在发现问题时最有效的定位方法是确定出错环节，然后再针对性地处理。所以熟悉流程很重要。</p><h3 id=实例上手>实例上手</h3><p>由于OpenGLES相关概念很多，为了尽可能减少相关概念的干扰，本文打算只将上述流程中的第一步拿出来着重讲解。同时利用涉及到的知识点，实现一个最小的示例——将窗口染成红色。</p><p>下面开始讲解第一个概念——EGL。</p><h3 id=egl>EGL</h3><p>OpenGL ES只是对绘图的抽象，没有提供运行环境的抽象。如要申请显存，显存在哪里，需要明确，图像计算好了，显示在哪里，也需要指定。EGL就是对这些环境抽象的集合，为了通俗地解释相关概念，我们可以玩一下角色扮演——假如让我们设计相关标准，我们该如何做。</p><p>首先很容易想到的是，我们需要一个显示器，因为OpenGL ES最终会生成一组颜色数据，我们想要看到这些颜色，肯定就需要一个显示器来显示这些颜色数据。同时我们知道显示器也有很多规格，很多特性，为了兼容各种从低端到高端的显示器，肯定就需要对它做一层抽象，并提供一些设置属性的方法，这就是<code>EGLDisplay</code>的任务。</p><p>确定了显示器之后，我们会发现我们每次只能选择整个显示器或者不使用，而我们实际使用时，肯定有只显示一个区域的情况，或者同时显示多个区域的情况，为了满足这种使用场景，就需要对显示器再做划分，使之可支持同时操作多个区域，而担任这层抽象任务的就是<code>EGLSurface</code>。</p><p>既然都支持了多区域，那肯定也要能够对区域进行配置，可能同一个显示器上，一个区域只需要显示黑白像素，另一个区域需要显示高清图片，为了使这些配置能够生效，并且相互独立，肯定需要一个抽象，它要能保存显示配置，并且能将OpenGL ES环境独立开来，使一个区域对OpenGL ES的API调用不会影响到另一个区域，这就是<code>EGLContext</code>。</p><p>以上就是EGL三个核心的概念，分别是对显示器，显示区域，显示配置的抽象。</p><p>以上的概念都是零散的，我们实际工作肯定需要将各部分连在一起，所以有必要对他们的工作流程做一个概括总结。
首先我们需要获取一个<code>EGLDisplay</code>，从而确定最终的显示设备，然后根据显示设备支持的配置配置一块显示区域<code>EGLSurface</code>。最后，用<code>EGLContext</code>将<code>EGLDisplay</code>、<code>EGLSurface</code>关联起来。一旦关联成功，也就意味着OpenGL ES环境准备完成，下一步就可以创建着色器，创建着色器程序，为绘制做准备了。</p><p>流程梳理完之后，我们来看看代码该怎么写。为了最大限度地降低理解障碍，本文将使用Java端的接口来做示例。</p><h3 id=准备egldisplay>准备EGLDisplay</h3><p>学习任何新技能都需要一个入口，而OpenGLES和EGL共同的入口都是<code>EGLDisplay</code>。
所以第一步我们需要得到一个<code>EGLDisplay</code>对象。我们不能直接创建这个对象，而是需要通过<code>eglGetDisplay</code>方法获取一个对象。这个对象很重要，几乎是后面所有EGL相关API的第一个参数，所以，通常需要把它缓存起来以供后续使用。
虽然已经有了<code>EGLDisplay</code>对象，但它还不能直接使用。需要调用<code>eglInitialize</code>进行一次初始化。这种现象在很多SDK中也很常见，获取完对象后都需要做一次初始化，保证内部状态恢复到初始态。</p><h3 id=获取配置>获取配置</h3><p>成功调用<code>eglInitialize</code>方法后，<code>EGLDisplay</code>对象就准备好了，就可以配置显示区域了。但是哪些配置信息有效，哪些配置信息支持我们不知道，因为硬件不同，支持的特性也不同，如果我们不顾硬件特性，直接将配置写死，可能会使代码在某台设备上运行失败，这不是我们想要看到的。因此，为了让配置在所有设备上都有效，有效的方式不是我们规定配置，而是我们主动去查询硬件是否只是我们想要的配置，即让<code>EGLDisplay</code>对象告诉我们。</p><p><code>EGLDisplay</code>提供了两种方法来查询硬件支持的配置，一种是直接获取设备支持的所有配置信息<code>eglGetConfigs</code>，另一种是开发者列举出期望的配置，然后主动查询设备是否支持列举出的这些配置<code>eglChooseConfig</code>。开发者可以选择任意一种方式来确定显示区域的配置项。如果方法调用成功，则就相当于确定了显示区域的配置项，我们可以用这些配置项配置<code>EGLSurface</code>了。</p><h3 id=配置显示区域>配置显示区域</h3><p>Android平台上使用<code>Surface</code>代表显示区域，但是通常我们不直接和<code>Surface</code>打交道，而是使用<code>SurfaceView</code>。但是使用<code>SurfaceView</code>也是有限制的，<code>Surface</code>只有在<code>SurafceView</code>中<code>SurfaceHolder</code>回调<code>surfaceCreated</code>发生后，<code>surfaceDestroyed</code>前才有效。也就是配置显示区域的操作，需要在收到<code>surfaceCreated</code>回调发生后才能进行。</p><p>配置显示区域需要通过<code>eglCreateWindowSurface</code>方法，前两个参数都是上面两步我们获得的对象，第三个参数是个<code>Surface</code>相关参数，可以是<code>Surface</code>，也可以是<code>SurfaceView</code>,<code>SurfaceHolder</code>。另外还可以用第四个参数传递一些关于<code>Surface</code>的配置信息。函数调用成功后，我们就获得了一个<code>EGLSurface</code>对象。</p><h3 id=将它们连起来>将它们连起来</h3><p>目前为止，<code>EGLDisplay</code>对象，<code>EGLSurface</code>对象还是独立的，后者只是通过前者获得了一些配置信息，除此之外再无其他联系。为了让两者关联在一起，我们需要借用<code>EGLContext</code>对象。
同样的，创建<code>EGLContext</code>对象需要通过<code>eglCreateContext</code>函数，前两个参数都是前面步骤中获取到的<code>EGLDisplay</code>、<code>EGLConfig</code>，特别的是第三个参数。第三个参数是<code>EGLContext</code>，通常情况下会传递<code>EGL_NO_CONTEXT</code>,代表创建独立的<code>EGLContext</code>对象。另外一种情况是，当两个渲染环境想共享资源时，创建第一个渲染环境还是正常传递<code>EGL_NO_CONTEXT</code>，创建第二个渲染环境时，则需要将第一个环境创建的<code>EGLContext</code>对象传递进来，则这时候第二个渲染环境就可以使用第一个渲染环境中创建的纹理，着色器，着色器程序，buffer类对象，也就是两个渲染环境共享了一些数据。
至此，三个重要对象都出场了，但是彼此间还没有联系起来，所以需要<code>eglMakeCurrent</code>函数来完成这个工作。这个函数会将<code>EGLContext</code>对象绑定到当前线程上的同时，将<code>EGLContext</code>对象也绑定到<code>EGLSurface</code>上，绑定完成后，三大对象连在了一起，OpenGL ES环境也准备妥当了。</p><p>在进入OpenGL ES世界前，我们最后用代码的方式回顾一下之前的EGL世界</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-kotlin data-lang=kotlin><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a2f;font-weight:700>val</span> display = EGL14.eglGetDisplay(EGL14.EGL_DEFAULT_DISPLAY)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#a2f;font-weight:700>if</span> (EGL14.EGL_NO_DISPLAY <span style=color:#666>==</span> display) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>     log()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>     <span style=color:#a2f;font-weight:700>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#a2f;font-weight:700>val</span> versions = IntArray(<span style=color:#666>2</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#a2f;font-weight:700>var</span> flag = EGL14.eglInitialize(display, versions, <span style=color:#666>0</span>, versions, <span style=color:#666>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#a2f;font-weight:700>if</span> (!flag) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>     log()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>     <span style=color:#a2f;font-weight:700>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#00f>Log</span>.i(TAG, <span style=color:#b44>&#34;EGL version:major = </span><span style=color:#b68;font-weight:700>${versions[0]}</span><span style=color:#b44>, minor = </span><span style=color:#b68;font-weight:700>${versions[1]}</span><span style=color:#b44>&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#080;font-style:italic>//我们希望红绿蓝通道是8位宽度
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>val</span> attr = intArrayOf(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>       EGL14.EGL_RED_SIZE, <span style=color:#666>8</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>       EGL14.EGL_GREEN_SIZE, <span style=color:#666>8</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>       EGL14.EGL_BLUE_SIZE, <span style=color:#666>8</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>       EGL14.EGL_NONE
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>      )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#a2f;font-weight:700>val</span> configs=Array&lt;EGLConfig?&gt;(<span style=color:#666>1</span>,{<span style=color:#a2f;font-weight:700>null</span>})
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#a2f;font-weight:700>val</span> numConfig=IntArray(<span style=color:#666>1</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>flag = EGL14.eglChooseConfig(display, attr, <span style=color:#666>0</span>, configs, <span style=color:#666>0</span>, <span style=color:#666>1</span>, numConfig, <span style=color:#666>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#a2f;font-weight:700>if</span> (!flag) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>      log()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>      <span style=color:#a2f;font-weight:700>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#a2f;font-weight:700>val</span> config=configs.first()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#a2f;font-weight:700>val</span> eglSurface=EGL14.eglCreateWindowSurface(display,config,surface, intArrayOf(EGL14.EGL_NONE),<span style=color:#666>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#a2f;font-weight:700>if</span> (EGL14.EGL_NO_SURFACE <span style=color:#666>==</span> eglSurface) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>      log()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>      <span style=color:#a2f;font-weight:700>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#a2f;font-weight:700>val</span> context=EGL14.eglCreateContext(display,config,EGL14.EGL_NO_CONTEXT, intArrayOf(EGL14.EGL_NONE),<span style=color:#666>0</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#a2f;font-weight:700>if</span> (EGL14.EGL_NO_CONTEXT <span style=color:#666>==</span> context) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>      log()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>      <span style=color:#a2f;font-weight:700>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>flag = EGL14.eglMakeCurrent(display, eglSurface, eglSurface, context)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#a2f;font-weight:700>if</span> (!flag) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>      log()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>      <span style=color:#a2f;font-weight:700>return</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>}
</span></span></code></pre></div><h3 id=进入opengl-es世界>进入OpenGL ES世界</h3><p>经过漫长的准备，我们终于将渲染环境准备好了，可以正常使用OpenGL ES API了。通常，在这之后就是创建着色器和着色器程序了。当然不同的渲染场景，调用的API通常会不一样，本文我们要将窗口染成红色，则不需要创建这些东西，只需要调用两个API就行，<code>glClearColor</code>设置清屏颜色，<code>glClear</code>设置清屏位。</p><p>当然，光有这两个功能函数还不行，我们还没设置绘制区域。是的，每次绘制都可以单独指定绘制区域，如第一次绘制我们绘制在左上角，第二次绘制，我们可以绘制在右下角，只需要在绘制前将绘制区域指定好就行，绘制区域的指定会在下次重新指定前都有效，用到的函数是<code>glViewport</code>。函数的前两个参数是指定起始位置，后两个参数则是距离起始位置的距离。</p><p>有了这三个函数的帮助，OpenGL ES就会将我们那黑黢黢的黑框框染成红色了。我们来看看代码</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-kotlin data-lang=kotlin><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#080;font-style:italic>//我们想渲染整个区域，所以起始点是左上角，截至点是view的宽高
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#080;font-style:italic></span>GLES20.glViewport(<span style=color:#666>0</span>,<span style=color:#666>0</span>,width,height)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#080;font-style:italic>//颜色范围是0-1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#080;font-style:italic></span>GLES20.glClearColor(<span style=color:#666>1f</span>,<span style=color:#666>0f</span>,<span style=color:#666>0f</span>,<span style=color:#666>1f</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT)
</span></span></code></pre></div><h3 id=上屏-1>上屏</h3><p>上一节我们已经将窗口染成了红色，但是运行应用后会发现显示的还是黑色，那是因为我们忘记了还有最后的上屏操作。因为进入到OpenGL ES世界后，理所应当的就是调用OpenGL ES的API，然而事实是永远记住，OpenGL ES API只负责绘制，显示相关的问题还得找EGL。OpenGL ES绘制完成后，需要使用<code>eglSwapBuffers</code>完成上屏操作。</p><h3 id=总结>总结</h3><p>本文是OpenGL ES系列的第一篇，着重写了一下我对EGL，OpenGL ES的大体理解，表述上可能没有那么严谨，旨在帮助读者搭建一个进入这个领域的通道，并对一些主要概念有基本的印象，后期我们会针对各个环节逐个深入，希望能够起到抛砖引玉的效果。</p><p>读完本文，读者应该对开发OpenGL ES应用流程有个简单的印象：EGL环境准备，着色器，着色器程序，渲染，上屏,清理。当然，本文只是着重讲到EGL环境准备这个环节。</p><p>关于EGL环境准备，我们有三个对象，从理解上来说就是显示器，显示区域，显示上下文，对应<code>EGLDisplay</code>，<code>EGLSurface</code>，<code>EGLContext</code>。环境准备主要是从<code>EGLDisplay</code>为起点，获取和配置这三个对象的过程，最后使用<code>eglMakeCurrent</code>关联起来。当然使用OpenGL ES API完成渲染后，记得要使用<code>eglSwapBuffers</code>完成上屏操作。</p><p>以上，就是本文的全部内容，咱们青山不改，绿水长流，下期见。</p><p>源码地址请看
<a href=https://github.com/hongui/OpenGLES title=这里 rel="noopener external nofollow noreferrer" target=_blank class=exturl>这里
<i class="fa fa-external-link-alt"></i></a></p></div><footer class=post-footer><div class=post-tags><a href=/tags/%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97>学习指南</a>
<a href=/tags/android>Android</a>
<a href=/tags/opengl-es>OpenGL ES</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
Android-OpenGLES学习-画个颜色</li><li class=post-copyright-author><strong>原文作者：</strong>
hongui</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://hongui.github.io/post/Android-OpenGLES%E5%AD%A6%E4%B9%A0-%E7%94%BB%E4%B8%AA%E9%A2%9C%E8%89%B2.html title=Android-OpenGLES学习-画个颜色>https://hongui.github.io/post/Android-OpenGLES%E5%AD%A6%E4%B9%A0-%E7%94%BB%E4%B8%AA%E9%A2%9C%E8%89%B2.html</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"></div><div class="post-nav-prev post-nav-item"><a href=/post/%E7%8E%B0%E4%BB%A3C++%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%20%E6%A8%A1%E6%9D%BF.html rel=prev title="现代C++学习指南 模板">现代C++学习指南 模板
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>hongui</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.113.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.4.0 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div></div></footer><script type=text/javascript src=https://unpkg.com/animejs@3.2.1/lib/anime.min.js defer></script>
<script type=text/javascript src=https://unpkg.com/viewerjs@1.11.0/dist/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#584394","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://hongui.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lawidget":{"id":"JrJFibzvtRuObfi1","js":"https://v6-widget.51.la/v6/laId/quote.js?theme=0\u0026col=true\u0026f=12\u0026display=0,0,0,1,0,1,1,1"},"lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"always","offset":8,"padding":16,"position":"left","width":240},"statis":{"enable":true,"plugin":"51la"},"vendor":{"plugins":"unpkg","router":"https://unpkg.com"},"version":"4.4.0","waline":{"cfg":{"emoji":false,"imguploader":false,"pageview":"#waline-pageview-count","placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.08bda9e4524cd731736163563f52818b7194694c2486534cc8a72a94c7209862.js defer></script></body></html>